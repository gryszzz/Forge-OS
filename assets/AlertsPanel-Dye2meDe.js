import{r as E,j as e}from"./react-vendor-D4yGots9.js";import{m as h,a as r,C as p,B as j,b as y,I as x}from"./index-BBSk8-Kr.js";import"./recharts-vendor-DS4t48dv.js";import"./d3-render-vendor-RkpHolfk.js";import"./d3-scale-vendor-BynLqmir.js";const $=[["risk_event","Risk Events","High-priority risk gate violations, kill-switch, drawdown halts"],["queue_pending","Queue Pending","Transactions awaiting wallet signature (threshold-based)"],["ai_outage","AI Outage","Quant engine failures and endpoint timeouts"],["regime_shift","Regime Shifts","Market regime changes detected by quant"],["tx_failure","Transaction Failures","Transaction broadcast failures and on-chain rejections"],["confirmation_timeout","Confirmation Timeout","Transactions not confirmed within expected time"],["low_balance","Low Balance","Wallet balance below configured threshold"],["network_disconnect","Network Disconnect","Kaspa DAG feed disconnection alerts"],["system","System","General system events and updates"]],C="https://corsproxy.io/?";function N(s){return fetch(C+encodeURIComponent(s),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:"ðŸ”” Forge-OS test alert - your Discord webhook is working!"})}).then(()=>({success:!0,message:"Discord connected!"})).catch(i=>({success:!1,message:"Discord failed: "+i.message}))}function F(s,i){return!s||!i?Promise.resolve({success:!1,message:"Telegram: Bot URL and Chat ID required"}):fetch(C+encodeURIComponent(s),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:i,text:"ðŸ”” Forge-OS test alert - your Telegram bot is working!",disable_web_page_preview:!0})}).then(()=>({success:!0,message:"Telegram connected!"})).catch(u=>({success:!1,message:"Telegram failed: "+u.message}))}function L(s){return s?fetch(C+encodeURIComponent(s),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:"Forge-OS Test Alert",message:"Your email webhook is working!"})}).then(()=>({success:!0,message:"Email webhook connected!"})).catch(i=>({success:!1,message:"Email webhook failed: "+i.message})):Promise.resolve({success:!1,message:"Email webhook URL required"})}function V({config:s,onPatch:i,onToggleType:u,onSave:_,onTest:D,saving:g,lastResult:o}){var w,S,B,I,W,A,U;const m=!!(s!=null&&s.enabled),k=!!(s!=null&&s.discordWebhookUrl||s!=null&&s.telegramBotApiUrl||s!=null&&s.emailWebhookUrl),[l,T]=E.useState({}),[t,c]=E.useState({}),v=async a=>{T(n=>({...n,[a]:!0})),c(n=>({...n,[a]:{success:!1,message:"Testing..."}}));let d={success:!1,message:"Unknown channel"};a==="discord"?d=await N(s==null?void 0:s.discordWebhookUrl):a==="telegram"?d=await F(s==null?void 0:s.telegramBotApiUrl,s==null?void 0:s.telegramChatId):a==="email"&&(d=await L(s==null?void 0:s.emailWebhookUrl)),c(n=>({...n,[a]:d})),T(n=>({...n,[a]:!1}))};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12,marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:18,color:r.text,fontWeight:700,...h,marginBottom:4},children:"Alert Center"}),e.jsx("div",{style:{fontSize:12,color:r.dim},children:"Get notified via Discord, Telegram, or email when important events happen"})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:m&&k?r.ok:r.dim}}),e.jsx("span",{style:{fontSize:11,color:m&&k?r.ok:r.dim,...h},children:m&&k?"ACTIVE":"INACTIVE"})]})]}),e.jsxs(p,{p:16,style:{marginBottom:16,background:`${r.accent}08`,border:`1px solid ${r.accent}30`},children:[e.jsx("div",{style:{fontSize:14,color:r.text,fontWeight:600,marginBottom:12,...h},children:"ðŸš€ Quick Start Guide"}),e.jsxs("div",{style:{fontSize:12,color:r.dim,lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{style:{color:r.accent},children:"1. Discord (Easiest):"})," Go to Server Settings â†’ Integrations â†’ Create Webhook â†’ Copy URL â†’ Paste below"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("strong",{style:{color:r.accent},children:"2. Telegram:"})," Message @BotFather to create a bot â†’ Copy API token â†’ Message your bot once â†’ Get Chat ID â†’ Paste both below"]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:r.accent},children:"3. Test:"}),' Click "Test" next to each channel to verify it works, then click "Save Config"']})]})]}),e.jsx(p,{p:16,style:{marginBottom:16,background:m?`${r.ok}08`:`${r.dim}08`,border:`1px solid ${m?r.ok:r.dim}30`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:10},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:m,onChange:a=>i({enabled:a.target.checked}),style:{width:18,height:18,accentColor:r.ok}}),e.jsx("span",{style:{fontSize:13,color:r.text,fontWeight:600},children:"Enable Alerts"})]})}),e.jsx("div",{style:{display:"flex",gap:8},children:(o==null?void 0:o.reason)&&e.jsx(j,{text:o.sent?"SENT":o.reason.replace(/_/g," "),color:o.sent?r.ok:r.warn})})]})}),e.jsxs(p,{p:0,style:{marginBottom:16},children:[e.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${r.border}`,background:r.s2},children:e.jsx("span",{style:{fontSize:12,color:r.text,fontWeight:600,...h},children:"ðŸ“± Notification Channels"})}),e.jsxs("div",{style:{padding:16},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:14,color:r.text,fontWeight:600},children:"Discord"}),(s==null?void 0:s.discordWebhookUrl)&&e.jsx(j,{text:(w=t==null?void 0:t.discord)!=null&&w.success?"âœ“ Connected":t!=null&&t.discord?"âœ— Failed":"",color:(S=t==null?void 0:t.discord)!=null&&S.success?r.ok:r.danger})]}),e.jsx(y,{onClick:()=>v("discord"),variant:"ghost",size:"sm",disabled:!(s!=null&&s.discordWebhookUrl)||(l==null?void 0:l.discord),children:l!=null&&l.discord?"Testing...":"Test"})]}),e.jsx(x,{label:"Discord Webhook URL",value:(s==null?void 0:s.discordWebhookUrl)||"",onChange:a=>{i({discordWebhookUrl:a}),c(d=>({...d,discord:void 0}))},placeholder:"https://discord.com/api/webhooks/..."}),(t==null?void 0:t.discord)&&e.jsx("div",{style:{fontSize:11,color:t.discord.success?r.ok:r.danger,marginTop:4},children:t.discord.message})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:14,color:r.text,fontWeight:600},children:"Telegram"}),(s==null?void 0:s.telegramBotApiUrl)&&(s==null?void 0:s.telegramChatId)&&e.jsx(j,{text:(B=t==null?void 0:t.telegram)!=null&&B.success?"âœ“ Connected":t!=null&&t.telegram?"âœ— Failed":"",color:(I=t==null?void 0:t.telegram)!=null&&I.success?r.ok:r.danger})]}),e.jsx(y,{onClick:()=>v("telegram"),variant:"ghost",size:"sm",disabled:!(s!=null&&s.telegramBotApiUrl)||!(s!=null&&s.telegramChatId)||(l==null?void 0:l.telegram),children:l!=null&&l.telegram?"Testing...":"Test"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(x,{label:"Telegram Bot Token",value:(s==null?void 0:s.telegramBotApiUrl)||"",onChange:a=>{i({telegramBotApiUrl:a}),c(d=>({...d,telegram:void 0}))},placeholder:"https://api.telegram.org/bot..."}),e.jsx(x,{label:"Chat ID",value:(s==null?void 0:s.telegramChatId)||"",onChange:a=>{i({telegramChatId:a}),c(d=>({...d,telegram:void 0}))},placeholder:"Your chat ID"})]}),(t==null?void 0:t.telegram)&&e.jsx("div",{style:{fontSize:11,color:t.telegram.success?r.ok:r.danger,marginTop:4},children:t.telegram.message})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:14,color:r.text,fontWeight:600},children:"Email (Custom Server)"}),(s==null?void 0:s.emailWebhookUrl)&&e.jsx(j,{text:(W=t==null?void 0:t.email)!=null&&W.success?"âœ“ Connected":t!=null&&t.email?"âœ— Failed":"",color:(A=t==null?void 0:t.email)!=null&&A.success?r.ok:r.danger})]}),e.jsx(y,{onClick:()=>v("email"),variant:"ghost",size:"sm",disabled:!(s!=null&&s.emailWebhookUrl)||(l==null?void 0:l.email),children:l!=null&&l.email?"Testing...":"Test"})]}),e.jsx(x,{label:"Email Webhook URL",value:(s==null?void 0:s.emailWebhookUrl)||"",onChange:a=>{i({emailWebhookUrl:a}),c(d=>({...d,email:void 0}))},placeholder:"https://your-backend.com/email"}),(t==null?void 0:t.email)&&e.jsx("div",{style:{fontSize:11,color:t.email.success?r.ok:r.danger,marginTop:4},children:t.email.message})]})]})]}),e.jsxs(p,{p:0,style:{marginBottom:16},children:[e.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${r.border}`,background:r.s2},children:e.jsx("span",{style:{fontSize:12,color:r.text,fontWeight:600,...h},children:"Alert Thresholds"})}),e.jsx("div",{style:{padding:16},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:12},children:[e.jsx(x,{label:"Queue Pending Threshold",value:String((s==null?void 0:s.queuePendingThreshold)||3),onChange:a=>i({queuePendingThreshold:Math.max(1,Math.min(50,Number(a)||3))}),type:"number",suffix:"txns",hint:"Alert when pending exceeds this count"}),e.jsx(x,{label:"Low Balance Threshold",value:String((s==null?void 0:s.lowBalanceThreshold)||100),onChange:a=>i({lowBalanceThreshold:Math.max(0,Math.min(1e5,Number(a)||100))}),type:"number",suffix:"KAS",hint:"Alert when balance drops below"})]})})]}),e.jsxs(p,{p:0,style:{marginBottom:16},children:[e.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${r.border}`,background:r.s2},children:e.jsx("span",{style:{fontSize:12,color:r.text,fontWeight:600,...h},children:"Alert Triggers"})}),e.jsx("div",{style:{padding:16},children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:10},children:$.map(([a,d,n])=>{var z;const b=!!((z=s==null?void 0:s.eventToggles)!=null&&z[a]);return e.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:10,background:b?`${r.ok}10`:r.s2,border:`1px solid ${b?r.ok:r.border}`,borderRadius:8,padding:"12px 14px",cursor:"pointer",transition:"all 0.15s"},children:[e.jsx("input",{type:"checkbox",checked:b,onChange:O=>u(a,O.target.checked),style:{marginTop:2,width:16,height:16,accentColor:r.ok}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,color:b?r.ok:r.text,fontWeight:600,...h},children:d}),e.jsx("div",{style:{fontSize:10,color:r.dim,marginTop:2},children:n})]})]},a)})})})]}),e.jsx(p,{p:16,children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:10},children:[e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(y,{onClick:_,disabled:g,children:g?"SAVING...":"SAVE CONFIG"}),e.jsx(y,{onClick:D,variant:"ghost",disabled:g,children:"TEST ALERT"})]}),o&&e.jsxs("div",{style:{fontSize:11,color:o.sent?r.ok:r.warn,...h},children:[o.sent?`âœ“ Sent via ${o.sentCount} channel${o.sentCount>1?"s":""}`:`âœ— ${((U=o.reason)==null?void 0:U.replace(/_/g," "))||"Failed"}`,Array.isArray(o.failures)&&o.failures.length>0&&e.jsxs("span",{style:{color:r.danger},children:[" Â· ",o.failures.join(", ")]})]})]})})]})}export{V as AlertsPanel};
