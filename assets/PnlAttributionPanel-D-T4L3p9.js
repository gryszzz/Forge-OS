import{j as i}from"./react-vendor-D4yGots9.js";import{a as t,m as d,B as c,C as s,L as T}from"./index-DKkH4U3d.js";function L({summary:e}){const v=Array.isArray(e==null?void 0:e.rows)?e.rows:[],a=Number(((e==null?void 0:e.netPnlKas)??(e==null?void 0:e.estimatedNetPnlKas))||0),g=String((e==null?void 0:e.netPnlMode)||"estimated"),p=Number((e==null?void 0:e.executedSignals)||0),S=Number((e==null?void 0:e.signalQualityScore)||0),h=Number((e==null?void 0:e.timingAlphaPct)||0),l=Math.max(1,Number((e==null?void 0:e.realizedMinConfirmations)||1)),x=Math.max(1,Number((e==null?void 0:e.confirmationFloorObservedMin)||l)),f=Math.max(x,Number((e==null?void 0:e.confirmationFloorObservedMax)||x)),N=Number((e==null?void 0:e.confidenceBrierScore)||0),j=Number((e==null?void 0:e.evCalibrationErrorPct)||0),b=Number((e==null?void 0:e.realizedVsExpectedEdgeKas)||0),$=Number((e==null?void 0:e.regimeHitRatePct)||0),R=Number((e==null?void 0:e.regimeHitSamples)||0),C=!!(e!=null&&e.truthDegraded),E=Number((e==null?void 0:e.truthMismatchRatePct)||0),F=Number((e==null?void 0:e.truthCheckedSignals)||0),P=Number((e==null?void 0:e.truthMismatchSignals)||0),z=String((e==null?void 0:e.truthDegradedReason)||""),k=g==="realized"?"Realized":g==="hybrid"?"Hybrid":"Estimated",A=[[g==="realized"?"Net PnL (realized)":g==="hybrid"?"Net PnL (hybrid)":"Net PnL (est)",`${a>=0?"+":""}${a.toFixed(4)} KAS`,a>=0?t.ok:t.danger,"Total net result after attribution components. Realized/hybrid depends on receipt confirmations and truth quality."],["Fill Rate",`${Number((e==null?void 0:e.fillRatePct)||0).toFixed(1)}%`,Number((e==null?void 0:e.fillRatePct)||0)>=70?t.ok:t.warn,"How often actionable signals became executed queue/broadcast outcomes."],["Confirmed Receipts",`${Number((e==null?void 0:e.confirmedSignals)||0)}`,Number((e==null?void 0:e.confirmedSignals)||0)>0?t.ok:t.dim,"Signals with receipt confirmation data available."],["Receipt Coverage",`${Number((e==null?void 0:e.receiptCoveragePct)||0).toFixed(1)}%`,Number((e==null?void 0:e.receiptCoveragePct)||0)>=50?t.ok:t.warn,"Share of executed signals with any receipt telemetry (chain or backend)."],["Realized Receipt Coverage",`${Number((e==null?void 0:e.realizedReceiptCoveragePct)||0).toFixed(1)}%`,Number((e==null?void 0:e.realizedReceiptCoveragePct)||0)>=50?t.ok:t.warn,"Share of executed signals that meet the active confirmation floor for realized accounting."],["Chain Fee Coverage",`${Number((e==null?void 0:e.chainFeeCoveragePct)||0).toFixed(1)}%`,Number((e==null?void 0:e.chainFeeCoveragePct)||0)>=50?t.ok:t.warn,"Share of signals with chain-derived fee data (stronger than estimated fee attribution)."],["Signal Quality",`${S.toFixed(3)}`,S>=.65?t.ok:t.warn,"Composite score summarizing signal usefulness from realized outcomes and execution funnel quality."],["Conf Brier (↓)",`${N.toFixed(4)}`,N<=.2?t.ok:t.warn,"Confidence calibration error. Lower is better; high means confidence is misaligned with actual outcomes."],["EV Cal Error",`${j.toFixed(3)}%`,j<=1.5?t.ok:t.warn,"Gap between expected value forecasts and realized edge. Lower is better."],["Regime Hit",`${$.toFixed(1)}% (${R})`,$>=55?t.ok:t.warn,"How often the strategy/regime framing matched profitable or correct execution conditions."],["Realized vs Exp Edge",`${b>=0?"+":""}${b.toFixed(4)} KAS`,b>=0?t.ok:t.warn,"Difference between realized edge and expected edge. Positive means execution + decisions beat forecast."],["Timing Alpha",`${h>=0?"+":""}${h.toFixed(3)}%`,h>=0?t.ok:t.warn,"Timing contribution from when the bot entered/exited relative to subsequent snapshots."],["Avg Confidence",`${Number((e==null?void 0:e.avgSignalConfidence)||0).toFixed(3)}`,t.text,"Average confidence output across signals (use with Brier score, not alone)."],["Avg EV",`${Number((e==null?void 0:e.avgExpectedValuePct)||0).toFixed(3)}%`,t.text,"Average expected value forecast before realized execution drift."],["Missed Fill",`${Number((e==null?void 0:e.missedFillKas)||0).toFixed(4)} KAS`,Number((e==null?void 0:e.missedFillKas)||0)>0?t.warn:t.ok,"Estimated opportunity left unexecuted due to queue delays/rejections/unfilled actions."],["Timing Wins",`${Number((e==null?void 0:e.timingWins)||0)}/${Number((e==null?void 0:e.timingSamples)||0)}`,t.dim,"Count of positive timing outcomes over all timing-evaluable signals."]];return i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:14},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[i.jsxs("div",{style:{fontSize:13,color:t.text,fontWeight:700,...d},children:["PnL Attribution (",k,")"]}),i.jsx(c,{text:`REALIZED FLOOR ${l} CONF`,color:l<=1?t.dim:t.warn}),i.jsx(c,{text:`FLOOR RANGE ${x}${x!==f?`-${f}`:""} CONF`,color:f>l?t.warn:t.dim})]}),i.jsx("div",{style:{fontSize:11,color:t.dim},children:g==="realized"?`Executed signals are fully receipt-confirmed with chain confirmation timestamps and a ${l}-confirmation realized floor.`:g==="hybrid"?`Confirmed receipts at or above ${l} confirmation${l===1?"":"s"} use realized broadcast→confirmation execution drift; remaining execution costs stay estimated.`:"Attribution is estimated from quant expected value, queue execution outcomes, fee logs, liquidity buckets, and market snapshots."}),C&&i.jsxs("div",{style:{fontSize:11,color:t.danger,marginTop:8},children:["Truth degraded: backend/chain receipt mismatch rate ",E.toFixed(1),"% (",P,"/",F," checks). Realized mode is downgraded until receipt consistency recovers.",z?` (${z})`:""]}),i.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:10},children:[i.jsx(c,{text:`CHAIN ${Number((e==null?void 0:e.provenanceChainSignals)||0)}/${p}`,color:Number((e==null?void 0:e.provenanceChainSignals)||0)>0?t.ok:t.dim}),i.jsx(c,{text:`BACKEND ${Number((e==null?void 0:e.provenanceBackendSignals)||0)}/${p}`,color:Number((e==null?void 0:e.provenanceBackendSignals)||0)>0?t.purple:t.dim}),i.jsx(c,{text:`ESTIMATED ${Number((e==null?void 0:e.provenanceEstimatedSignals)||0)}/${p}`,color:Number((e==null?void 0:e.provenanceEstimatedSignals)||0)>0?t.warn:t.dim}),C&&i.jsx(c,{text:"TRUTH DEGRADED",color:t.danger})]}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:8,marginTop:10},children:[["Profit Truth","Net PnL becomes trustworthy only as receipt coverage and confirmation depth increase."],["Calibration","Conf Brier + EV Cal Error + Regime Hit measure whether the bot's confidence and forecasts match reality."],["Execution Drag","Timing Alpha, fees, and missed fills explain why a good signal can still underperform."]].map(([n,o])=>i.jsxs("div",{style:{background:`linear-gradient(180deg, ${t.s2} 0%, ${t.s1} 100%)`,border:`1px solid ${t.border}`,borderRadius:6,padding:"9px 10px"},children:[i.jsx("div",{style:{fontSize:10,color:t.accent,...d,marginBottom:3},children:n}),i.jsx("div",{style:{fontSize:11,color:t.dim,lineHeight:1.35},children:o})]},String(n)))})]}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:10,marginBottom:12},children:A.map(([n,o,r,B])=>i.jsxs(s,{p:12,title:B,children:[i.jsx("div",{style:{fontSize:10,color:t.dim,...d,marginBottom:4},children:n}),i.jsx("div",{style:{fontSize:13,color:r,fontWeight:700,...d},children:o})]},String(n)))}),i.jsxs(s,{p:0,style:{marginBottom:12},children:[i.jsx("div",{style:{padding:"11px 16px",borderBottom:`1px solid ${t.border}`},children:i.jsx("span",{style:{fontSize:11,color:t.dim,...d},children:"ATTRIBUTION BREAKDOWN"})}),v.length===0&&i.jsx("div",{style:{padding:16,fontSize:12,color:t.dim},children:"Run more cycles to build attribution history."}),v.map(n=>{const o=Number((n==null?void 0:n.value)||0),r=o>=0?t.ok:t.danger;return i.jsxs("div",{style:{padding:"10px 16px",borderBottom:`1px solid ${t.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"center",marginBottom:4},children:[i.jsx("div",{style:{fontSize:12,color:t.text,...d},children:n==null?void 0:n.label}),i.jsx(c,{text:`${o>=0?"+":""}${o.toFixed(4)}${String((n==null?void 0:n.label)||"").includes("Alpha")?"%":" KAS"}`,color:r})]}),(n==null?void 0:n.hint)&&i.jsx("div",{style:{fontSize:11,color:t.dim},children:n.hint})]},String(n==null?void 0:n.label))})]}),i.jsxs(s,{p:14,children:[i.jsx(T,{children:"Execution Funnel"}),i.jsx("div",{style:{fontSize:11,color:t.dim,marginBottom:8},children:"Funnel counts explain where profitable intent gets lost: queue pending, user rejects, and execution delays usually show up here before they hit net PnL."}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:8},children:[["Actionable Signals",(e==null?void 0:e.actionableSignals)??0,t.text],["Executed",(e==null?void 0:e.executedSignals)??0,t.ok],["Pending",(e==null?void 0:e.pendingSignals)??0,t.warn],["Rejected",(e==null?void 0:e.rejectedSignals)??0,t.danger]].map(([n,o,r])=>i.jsxs("div",{style:{background:t.s2,borderRadius:6,padding:"9px 12px"},children:[i.jsx("div",{style:{fontSize:10,color:t.dim,...d,marginBottom:3},children:n}),i.jsx("div",{style:{fontSize:13,color:r,fontWeight:700,...d},children:o})]},String(n)))})]})]})}export{L as PnlAttributionPanel};
