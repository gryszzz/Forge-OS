import{r as B,j as n}from"./react-vendor-D4yGots9.js";import{a as e,m as f,b as Se,C as F,B as _,d as ge}from"./index-BBSk8-Kr.js";import"./recharts-vendor-DS4t48dv.js";import"./d3-render-vendor-RkpHolfk.js";import"./d3-scale-vendor-BynLqmir.js";const Ie={},M=Ie,_e=String(M.VITE_DECISION_AUDIT_SIGNER_URL||"").trim(),fe=String(M.VITE_DECISION_AUDIT_SIGNER_PUBLIC_KEY_URL||"").trim(),be=String(M.VITE_DECISION_AUDIT_SIGNER_TOKEN||"").trim(),Ee=Math.max(5e3,Number(M.VITE_DECISION_AUDIT_SIGNER_PUBLIC_KEY_CACHE_TTL_MS||3e5)),ke=String(M.VITE_DECISION_AUDIT_SIGNER_PINNED_FINGERPRINTS||"").split(",").map(r=>r.trim()).filter(Boolean),je=/^(1|true|yes)$/i.test(String(M.VITE_DECISION_AUDIT_SIGNER_REQUIRE_PINNED||"false"));let V=null,K=null;function Z(){return Date.now()}function J(r){if(r==null)return"null";const l=typeof r;return l==="number"?Number.isFinite(r)?JSON.stringify(r):"null":l==="boolean"?r?"true":"false":l==="string"?JSON.stringify(r):Array.isArray(r)?`[${r.map(c=>J(c)).join(",")}]`:l==="object"?`{${Object.entries(r).filter(([,i])=>typeof i<"u").sort(([i],[y])=>i.localeCompare(y)).map(([i,y])=>`${JSON.stringify(i)}:${J(y)}`).join(",")}}`:"null"}function we(r){return{audit_record_version:String((r==null?void 0:r.audit_record_version)||""),hash_algo:String((r==null?void 0:r.hash_algo)||""),prompt_version:String((r==null?void 0:r.prompt_version)||""),ai_response_schema_version:String((r==null?void 0:r.ai_response_schema_version)||""),quant_feature_snapshot_hash:String((r==null?void 0:r.quant_feature_snapshot_hash)||""),decision_hash:String((r==null?void 0:r.decision_hash)||""),overlay_plan_reason:String((r==null?void 0:r.overlay_plan_reason)||""),engine_path:String((r==null?void 0:r.engine_path)||""),created_ts:Math.max(0,Math.round(Number((r==null?void 0:r.created_ts)||0)))}}function ve(){if(fe)return fe;if(!_e)return"";try{const r=new URL(_e);return r.pathname.endsWith("/v1/audit-sign")?(r.pathname=r.pathname.replace(/\/v1\/audit-sign$/,"/v1/public-key"),r.toString()):""}catch{return""}}function he(r){const l=String(r||"").replace(/-/g,"+").replace(/_/g,"/"),c=l.length%4===0?"":"=".repeat(4-l.length%4),i=atob(l+c),y=new Uint8Array(i.length);for(let x=0;x<i.length;x+=1)y[x]=i.charCodeAt(x);return y}function Ce(r){let l="";for(let c=0;c<r.length;c+=1)l+=String.fromCharCode(r[c]);return btoa(l).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Ae(r){const l=String(r||"").replace(/-----BEGIN PUBLIC KEY-----/g,"").replace(/-----END PUBLIC KEY-----/g,"").replace(/\s+/g,"");return he(l.replace(/\+/g,"-").replace(/\//g,"_"))}async function xe(r){const l=new TextEncoder().encode(String(r||"")),c=new Uint8Array(await crypto.subtle.digest("SHA-256",l));return Ce(c)}async function X(r){return`sha256:${await xe(String(r||""))}`}function Ne(r){return(Array.isArray(r)?r:ke).map(c=>String(c||"").trim()).filter(Boolean)}function Te(r){return String(r||"").trim().toUpperCase()}async function De(r,l){const c=Ae(r);if(l==="ED25519")return{key:await crypto.subtle.importKey("spki",c,{name:"Ed25519"},!1,["verify"]),verifyAlgo:{name:"Ed25519"}};if(l==="ES256")return{key:await crypto.subtle.importKey("spki",c,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),verifyAlgo:{name:"ECDSA",hash:"SHA-256"}};if(l==="RS256")return{key:await crypto.subtle.importKey("spki",c,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!1,["verify"]),verifyAlgo:{name:"RSASSA-PKCS1-v1_5"}};throw new Error(`unsupported_alg:${l||"unknown"}`)}function Be(){return!!(V&&Z()-V.ts<Ee)}async function Pe(r){if(Be())return V;if(K)return K;const l=String(ve()).trim();return l?(K=(async()=>{try{const c={},i=String((r==null?void 0:r.token)||be||"").trim();i&&(c.Authorization=`Bearer ${i}`);const y=await fetch(l,{headers:c}),x=await y.json().catch(()=>({}));if(!y.ok)return null;const o=x!=null&&x.key&&typeof x.key=="object"?x.key:x,k=String((o==null?void 0:o.publicKeyPem)||(o==null?void 0:o.public_key_pem)||"");if(!k.trim())return null;const S={ts:Z(),keyId:o!=null&&o.keyId?String(o.keyId):o!=null&&o.key_id?String(o.key_id):null,alg:o!=null&&o.alg?String(o.alg):o!=null&&o.algorithm?String(o.algorithm):null,publicKeyPem:k,fingerprint:typeof(o==null?void 0:o.publicKeyFingerprint)=="string"?String(o.publicKeyFingerprint):typeof(o==null?void 0:o.public_key_fingerprint)=="string"?String(o.public_key_fingerprint):await X(k)};return V=S,S}catch{return null}finally{K=null}})(),K):null}function A(r){return{status:"error",verified:!1,pinMatched:null,pinsConfigured:!1,keyFingerprint:null,keyId:null,alg:null,source:"none",verifiedAtTs:Z(),...r}}function Ue(){var r;return!!((r=globalThis.crypto)!=null&&r.subtle&&globalThis.TextEncoder&&globalThis.atob&&globalThis.btoa)}async function ze(r,l){if(!Ue())return A({status:"unsupported",detail:"webcrypto_unavailable"});const c=r==null?void 0:r.audit_record,i=c==null?void 0:c.crypto_signature;if(!c||!i||String((i==null?void 0:i.status)||"").toLowerCase()!=="signed")return A({status:"missing_signature",detail:"crypto_signature_not_signed"});const y=String((i==null?void 0:i.sig_b64u)||"").trim();if(!y)return A({status:"missing_signature",detail:"sig_b64u_missing"});const x=we(c);if(!x.decision_hash||!x.quant_feature_snapshot_hash)return A({status:"missing_payload",detail:"audit_payload_missing_hashes"});const o=J(x);let k=String((i==null?void 0:i.public_key_pem)||""),S=null,j="none",a=null;if(k.trim())j="embedded",S=await X(k);else{if(a=await Pe(l),!(a!=null&&a.publicKeyPem))return A({status:"error",detail:"public_key_not_available",keyId:String((i==null?void 0:i.key_id)||"")||null,alg:String((i==null?void 0:i.alg)||"")||null});k=a.publicKeyPem,S=a.fingerprint||await X(k),j="fetched"}const O=Ne(l==null?void 0:l.pinnedFingerprints),w=O.length>0,T=w?O.includes(String(S||"")):null;if(je&&w&&!T)return A({status:"unpinned",verified:!1,pinMatched:!1,pinsConfigured:w,keyFingerprint:S,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:String((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||"")||null,source:j,detail:"signer_key_not_pinned"});try{const N=String((i==null?void 0:i.payload_hash_sha256_b64u)||"").trim();if(N&&await xe(o)!==N)return A({status:"invalid",detail:"payload_hash_mismatch",keyFingerprint:S,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:String((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||"")||null,source:j,pinsConfigured:w,pinMatched:T});const D=Te((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||""),{key:G,verifyAlgo:q}=await De(k,D),L=await crypto.subtle.verify(q,G,he(y),new TextEncoder().encode(o));return A({status:L?"verified":"invalid",verified:!!L,pinMatched:T,pinsConfigured:w,keyFingerprint:S,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:D||null,source:j,detail:L?void 0:"signature_verify_failed"})}catch(N){const D=String((N==null?void 0:N.message)||"verify_failed");return/unsupported_alg/i.test(D)?A({status:"unsupported",detail:D,pinMatched:T,pinsConfigured:w,keyFingerprint:S,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:String((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||"")||null,source:j}):A({status:"error",detail:D,pinMatched:T,pinsConfigured:w,keyFingerprint:S,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:String((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||"")||null,source:j})}}function $e(r){const l=r==null?void 0:r.audit_record,c=l==null?void 0:l.crypto_signature,i=String((l==null?void 0:l.decision_hash)||"").trim(),y=String((c==null?void 0:c.sig_b64u)||"").trim(),x=String((c==null?void 0:c.key_id)||"").trim();return!i||!y?"":`${i}|${x}|${y.slice(0,48)}`}function Oe({decisions:r,queue:l=[],loading:c,onRun:i}){var ne,re,ie,se,oe,ae,le;const[y,x]=B.useState(typeof window<"u"?window.innerWidth:1200);B.useEffect(()=>{if(typeof window>"u")return;const t=()=>x(window.innerWidth);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const o=y<760,k=o?"repeat(2,1fr)":"repeat(4,1fr)",S=o?"78px 108px 1fr":"90px 200px 96px 88px 1fr",j=Array.isArray(l)?l:[],[a,O]=B.useState({}),w=B.useRef(new Set),[T,ee]=B.useState(!1),[N,D]=B.useState(!1),G=B.useMemo(()=>{var d,m;const t=new Map;for(const p of j){if(!p||(p==null?void 0:p.metaKind)==="treasury_fee")continue;const h=String(((m=(d=p==null?void 0:p.dec)==null?void 0:d.audit_record)==null?void 0:m.decision_hash)||"").trim();if(!h)continue;const g=t.get(h);(!g||Number((p==null?void 0:p.ts)||0)>Number((g==null?void 0:g.ts)||0))&&t.set(h,p)}return t},[j]),q=t=>{var p,h;if(!(t!=null&&t.dec))return null;const d=String(((h=(p=t==null?void 0:t.dec)==null?void 0:p.audit_record)==null?void 0:h.decision_hash)||"").trim();return d&&G.has(d)?G.get(d):j.filter(g=>(g==null?void 0:g.metaKind)!=="treasury_fee"&&(g==null?void 0:g.dec)===t.dec).sort((g,v)=>Number((v==null?void 0:v.ts)||0)-Number((g==null?void 0:g.ts)||0))[0]||null},L=t=>{if(!t)return{text:"ESTIMATED",color:e.warn};const d=String((t==null?void 0:t.receipt_imported_from)||"").toLowerCase(),m=String((t==null?void 0:t.receipt_source_path)||"").toLowerCase(),p=String((t==null?void 0:t.confirm_ts_source)||"").toLowerCase();return d==="callback_consumer"||m.includes("callback-consumer")?{text:"BACKEND",color:e.purple}:d==="kaspa_api"||p==="chain"?{text:"CHAIN",color:e.ok}:{text:"ESTIMATED",color:e.warn}},Q=t=>{const d=q(t),m=L(d);if(!d)return{text:"SIMULATED",color:e.dim,provenance:{text:"ESTIMATED",color:e.warn}};if(String((d==null?void 0:d.status)||"")!=="signed")return{text:"ESTIMATED",color:e.warn,provenance:m};const p=String((d==null?void 0:d.receipt_lifecycle)||"submitted");return p==="confirmed"?m.text==="BACKEND"?{text:"BACKEND CONFIRMED",color:e.purple,provenance:m}:m.text==="CHAIN"?{text:"CHAIN CONFIRMED",color:e.ok,provenance:m}:{text:"ESTIMATED",color:e.warn,provenance:m}:p==="broadcasted"||p==="pending_confirm"||p==="submitted"?{text:"BROADCASTED",color:e.warn,provenance:m}:{text:"ESTIMATED",color:e.warn,provenance:m}},I=r[0],s=I==null?void 0:I.dec,R=(s==null?void 0:s.action)==="ACCUMULATE"?e.ok:(s==null?void 0:s.action)==="REDUCE"?e.danger:(s==null?void 0:s.action)==="REBALANCE"?e.purple:e.warn,W=String((s==null?void 0:s.decision_source)||(I==null?void 0:I.source)||"ai"),me=W==="hybrid-ai"?e.accent:W==="quant-core"?e.text:W==="fallback"?e.warn:e.ok,u=(s==null?void 0:s.quant_metrics)||null,P=I?Q(I):null,b=((ne=s==null?void 0:s.audit_record)==null?void 0:ne.crypto_signature)||null,E=(ie=(re=I==null?void 0:I.dec)==null?void 0:re.audit_record)!=null&&ie.decision_hash&&((se=a[String(I.dec.audit_record.decision_hash)])==null?void 0:se.result)||null,Y=t=>t==null||t===""?"—":typeof t=="number"?Number.isFinite(t)?Math.abs(t)>=1e3?String(Math.round(t)):String(t):"—":typeof t=="boolean"?t?"yes":"no":String(t);B.useEffect(()=>{var m,p;let t=!1;const d=(Array.isArray(r)?r:[]).slice(0,24);for(const h of d){const g=(m=h==null?void 0:h.dec)==null?void 0:m.audit_record,v=String((g==null?void 0:g.decision_hash)||"").trim();if(!v||String(((p=g==null?void 0:g.crypto_signature)==null?void 0:p.status)||"").toLowerCase()!=="signed")continue;const C=$e(h.dec);if(!C)continue;const U=a[v];(U==null?void 0:U.cacheKey)!==C&&(w.current.has(C)||(w.current.add(C),ze(h.dec).then(H=>{t||O(z=>{const $=z[v];return($==null?void 0:$.cacheKey)===C?z:{...z,[v]:{cacheKey:C,result:H}}})}).finally(()=>{w.current.delete(C)})))}return()=>{t=!0}},[a,r]);const te=t=>t?t.status==="verified"?n.jsx(_,{text:"CRYPTO VERIFIED",color:e.ok}):t.status==="unpinned"?n.jsx(_,{text:"UNPINNED KEY",color:e.warn}):t.status==="invalid"?n.jsx(_,{text:"CRYPTO INVALID",color:e.danger}):t.status==="unsupported"?n.jsx(_,{text:"VERIFY UNSUPPORTED",color:e.dim}):t.status==="error"?n.jsx(_,{text:"VERIFY ERROR",color:e.warn}):n.jsx(_,{text:"VERIFY UNKNOWN",color:e.dim}):n.jsx(_,{text:"CRYPTO VERIFY…",color:e.dim}),ye=t=>{if(!t)return"crypto verify pending";const d=[`verify ${String(t.status||"unknown")}`,t.alg?String(t.alg):"",t.keyFingerprint?`fp ${String(t.keyFingerprint).slice(0,26)}`:"",t.pinMatched===!0?"pinned":t.pinMatched===!1?"unpinned":"",t.source?`src ${t.source}`:""].filter(Boolean);return t.detail&&d.push(String(t.detail).slice(0,80)),d.join(" · ")};return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",flexDirection:o?"column":"row",justifyContent:"space-between",alignItems:o?"flex-start":"center",marginBottom:16,gap:o?8:0},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:13,color:e.text,fontWeight:700,...f},children:"Intelligence Layer"}),n.jsx("div",{style:{fontSize:11,color:e.dim},children:"On-chain quant core · Kelly sizing · regime detection · AI risk overlay"})]}),n.jsx(Se,{onClick:i,disabled:c,children:c?"PROCESSING...":"RUN CYCLE"})]}),c&&n.jsxs(F,{p:24,style:{textAlign:"center",marginBottom:12},children:[n.jsx("div",{style:{fontSize:12,color:e.dim,...f,marginBottom:6},children:"Running quant engine..."}),n.jsx("div",{style:{fontSize:11,color:e.dim},children:"Kaspa on-chain data → Kelly sizing → Monte Carlo → Decision"})]}),!s&&!c&&n.jsxs(F,{p:40,style:{textAlign:"center",marginBottom:12},children:[n.jsx("div",{style:{fontSize:28,marginBottom:12},children:"⚡"}),n.jsx("div",{style:{fontSize:13,color:e.text,fontWeight:700,...f,marginBottom:6},children:"No Intelligence Signal Yet"}),n.jsx("div",{style:{fontSize:12,color:e.dim},children:"Run a cycle to generate a structured decision with Kelly sizing, Monte Carlo confidence, and on-chain regime detection."})]}),s&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{background:`linear-gradient(135deg, ${R}12 0%, ${e.s1} 100%)`,border:`1px solid ${R}35`,borderRadius:10,padding:o?"14px 16px":"18px 22px",marginBottom:12,display:"flex",gap:18,alignItems:"center",flexWrap:o?"wrap":"nowrap"},children:[n.jsx("div",{style:{flexShrink:0,width:72,height:72,borderRadius:"50%",background:`conic-gradient(${R} 0deg ${Math.round(s.confidence_score*360)}deg, ${e.s2} ${Math.round(s.confidence_score*360)}deg 360deg)`,display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsxs("div",{style:{width:52,height:52,borderRadius:"50%",background:e.s1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[n.jsx("span",{style:{fontSize:13,fontWeight:700,color:R,...f,lineHeight:1},children:Math.round(s.confidence_score*100)}),n.jsx("span",{style:{fontSize:8,color:e.dim,...f},children:"CONF%"})]})}),n.jsxs("div",{style:{flex:1,minWidth:0},children:[n.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginBottom:8,alignItems:"center"},children:[n.jsx("span",{style:{fontSize:16,fontWeight:700,color:R,letterSpacing:"0.1em",...f},children:s.action}),n.jsx("span",{style:{width:1,height:14,background:e.border,display:"inline-block",flexShrink:0}}),n.jsx(_,{text:s.strategy_phase,color:e.purple}),n.jsx(_,{text:`SRC: ${W.toUpperCase()}`,color:me}),(u==null?void 0:u.regime)&&n.jsx(_,{text:String(u.regime).replace(/_/g," ").toUpperCase(),color:e.accent}),P&&n.jsx(_,{text:P.text,color:P.color}),P&&n.jsx(_,{text:`PROV ${P.provenance.text}`,color:P.provenance.color})]}),n.jsx("div",{style:{fontSize:12,color:e.text,lineHeight:1.55,marginBottom:8},children:s.rationale}),n.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",alignItems:"center"},children:[((oe=s==null?void 0:s.audit_record)==null?void 0:oe.audit_sig)&&n.jsx(_,{text:"AUDIT READY",color:e.text}),(b==null?void 0:b.status)==="signed"&&n.jsx(_,{text:"CRYPTO SIGNED",color:e.ok}),(b==null?void 0:b.status)==="signed"&&te(E),(E==null?void 0:E.pinMatched)===!0&&n.jsx(_,{text:"KEY PINNED",color:e.accent}),(E==null?void 0:E.pinMatched)===!1&&n.jsx(_,{text:"KEY UNPINNED",color:e.warn}),(b==null?void 0:b.status)==="error"&&n.jsx(_,{text:"SIGN ERR",color:e.warn}),n.jsx("span",{style:{fontSize:10,color:e.dim,...f},children:ge(I.ts)})]})]}),n.jsxs("div",{style:{flexShrink:0,background:e.s2,borderRadius:8,padding:"12px 16px",textAlign:"center",border:`1px solid ${s.risk_score<=.4?e.ok:s.risk_score<=.7?e.warn:e.danger}30`},children:[n.jsx("div",{style:{fontSize:9,color:e.dim,...f,letterSpacing:"0.1em",marginBottom:2},children:"RISK"}),n.jsx("div",{style:{fontSize:20,fontWeight:700,...f,color:s.risk_score<=.4?e.ok:s.risk_score<=.7?e.warn:e.danger},children:s.risk_score}),n.jsx("div",{style:{fontSize:9,color:e.dim,...f},children:"SCORE"})]})]}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:k,gap:8,marginBottom:12},children:[{k:"Kelly Fraction",v:`${(s.kelly_fraction*100).toFixed(1)}%`,c:e.accent,hint:"Position sizing fraction after quant/AI guardrails. Higher is more aggressive."},{k:"Monte Carlo Win",v:`${s.monte_carlo_win_pct}%`,c:e.ok,hint:"Model-estimated win probability for the current setup; not guaranteed realized PnL."},{k:"Capital Alloc",v:`${s.capital_allocation_kas} KAS`,c:e.text,hint:"Proposed KAS amount for this cycle after portfolio caps and risk controls."},{k:"Expected Value",v:`+${s.expected_value_pct}%`,c:e.ok,hint:"Expected edge for this decision before realized execution drift."},{k:"Stop Loss",v:`-${s.stop_loss_pct}%`,c:e.danger,hint:"Loss control target used for risk envelope logic."},{k:"Take Profit",v:`+${s.take_profit_pct}%`,c:e.ok,hint:"Profit-taking target used for expected value and phase planning."},{k:"Volatility",v:String(s.volatility_estimate),c:s.volatility_estimate==="HIGH"?e.danger:s.volatility_estimate==="MEDIUM"?e.warn:e.ok,hint:"Quant volatility bucket; high volatility tightens signal trust."},{k:"Liquidity Impact",v:String(s.liquidity_impact),c:s.liquidity_impact==="SIGNIFICANT"?e.danger:e.dim,hint:"Estimated execution friction/slippage pressure."},{k:"Engine Latency",v:`${s.engine_latency_ms||0}ms`,c:(s.engine_latency_ms||0)<=2500?e.ok:e.warn,hint:"Decision engine runtime (quant + AI overlay + fusion) for this cycle."},{k:"Data Quality",v:Y(u==null?void 0:u.data_quality_score),c:((u==null?void 0:u.data_quality_score)??0)>=.75?e.ok:e.warn,hint:"Signal trust score from quant feature sufficiency. Low quality reduces automation confidence."}].map(t=>n.jsxs("div",{title:t.hint,style:{background:`linear-gradient(135deg, ${t.c}10 0%, ${e.s2} 100%)`,border:`1px solid ${t.c}20`,borderRadius:6,padding:"10px 12px"},children:[n.jsx("div",{style:{fontSize:9,color:e.dim,...f,letterSpacing:"0.06em",marginBottom:4},children:t.k.toUpperCase()}),n.jsx("div",{style:{fontSize:13,color:t.c,fontWeight:700,...f},children:t.v})]},t.k))}),s.next_review_trigger&&n.jsxs("div",{style:{background:e.aLow,border:`1px solid ${e.accent}25`,borderRadius:6,padding:"10px 14px",marginBottom:12,display:"flex",gap:8,alignItems:"flex-start"},children:[n.jsx("span",{style:{fontSize:9,color:e.accent,...f,letterSpacing:"0.08em",flexShrink:0,paddingTop:2},children:"NEXT TRIGGER"}),n.jsx("span",{style:{fontSize:12,color:e.text},children:s.next_review_trigger})]}),((ae=s.risk_factors)==null?void 0:ae.length)>0&&n.jsxs("div",{style:{background:`${e.warn}08`,border:`1px solid ${e.warn}30`,borderRadius:6,padding:"10px 14px",marginBottom:12},children:[n.jsx("div",{style:{fontSize:9,color:e.warn,...f,letterSpacing:"0.08em",marginBottom:6},children:"RISK FACTORS"}),n.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:s.risk_factors.map((t,d)=>n.jsx(_,{text:t,color:e.warn},d))})]}),u&&n.jsxs(F,{p:0,style:{marginBottom:10},children:[n.jsxs("div",{onClick:()=>ee(t=>!t),style:{padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("span",{style:{fontSize:11,color:e.text,fontWeight:700,...f},children:"QUANT DIAGNOSTICS"}),n.jsx(_,{text:`${Y(u.sample_count)} SAMPLES`,color:e.dim}),n.jsx(_,{text:`EDGE ${Y(u.edge_score)}`,color:(Number(u.edge_score)||0)>0?e.ok:e.warn}),u.ai_overlay_applied&&n.jsx(_,{text:"AI OVERLAY",color:e.accent})]}),n.jsx("span",{style:{fontSize:12,color:e.dim,flexShrink:0},children:T?"▲":"▼"})]}),T&&n.jsxs("div",{style:{padding:"0 16px 16px",borderTop:`1px solid ${e.border}`},children:[n.jsx("div",{style:{fontSize:11,color:e.dim,marginBottom:10,marginTop:10,lineHeight:1.4},children:"Raw quant features behind the decision — use these to understand regime behavior and why guardrails or AI fusion changed sizing/action."}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:o?"1fr":"1fr 1fr",gap:6},children:[["Risk Profile",u.risk_profile],["Risk Ceiling",u.risk_ceiling],["Kelly Cap",u.kelly_cap],["Price USD",u.price_usd],["1-step Return %",u.price_return_1_pct],["5-step Return %",u.price_return_5_pct],["20-step Return %",u.price_return_20_pct],["Momentum Z",u.momentum_z],["EWMA Volatility",u.ewma_volatility],["DAA Velocity",u.daa_velocity],["DAA Slope",u.daa_slope],["Drawdown %",u.drawdown_pct],["Model Win Prob",u.win_probability_model],["Exposure Cap %",u.exposure_cap_pct]].map(([t,d])=>n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10,background:e.s2,borderRadius:4,padding:"8px 12px"},children:[n.jsx("span",{style:{fontSize:11,color:e.dim,...f},children:t}),n.jsx("span",{style:{fontSize:11,color:e.text,fontWeight:600,...f},children:Y(d)})]},t))})]})]}),s.audit_record&&n.jsxs(F,{p:0,style:{marginBottom:10},children:[n.jsxs("div",{onClick:()=>D(t=>!t),style:{padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("span",{style:{fontSize:11,color:e.text,fontWeight:700,...f},children:"AUDIT TRAIL"}),(b==null?void 0:b.status)==="signed"&&te(E),(E==null?void 0:E.pinMatched)===!0&&n.jsx(_,{text:"PINNED",color:e.accent})]}),n.jsx("span",{style:{fontSize:12,color:e.dim,flexShrink:0},children:N?"▲":"▼"})]}),N&&n.jsxs("div",{style:{padding:"0 16px 16px",borderTop:`1px solid ${e.border}`},children:[s.decision_source_detail&&n.jsxs("div",{style:{fontSize:11,color:e.dim,...f,marginTop:10,marginBottom:8},children:["source detail: ",s.decision_source_detail]}),n.jsxs("div",{style:{fontSize:11,color:e.dim,...f,lineHeight:1.8,marginTop:s.decision_source_detail?0:10},children:[n.jsxs("div",{children:["audit: ",String(s.audit_record.audit_record_version||"—")," · prompt ",String(s.audit_record.prompt_version||"—")," · schema ",String(s.audit_record.ai_response_schema_version||"—")]}),n.jsxs("div",{children:["qhash ",String(s.audit_record.quant_feature_snapshot_hash||"—").slice(0,22),"… · dhash ",String(s.audit_record.decision_hash||"—").slice(0,22),"…"]}),n.jsxs("div",{children:["sig ",String(s.audit_record.audit_sig||"—").slice(0,18),"…"]}),s.audit_record.crypto_signature&&n.jsxs("div",{children:["crypto ",String(s.audit_record.crypto_signature.status||"unknown")," · ",String(s.audit_record.crypto_signature.alg||"—")," · key ",String(s.audit_record.crypto_signature.key_id||"—").slice(0,22)]}),((le=s.audit_record.crypto_signature)==null?void 0:le.status)==="signed"&&n.jsx("div",{children:ye(E)})]})]})]}),r.length>1&&n.jsxs(F,{p:0,children:[n.jsxs("div",{style:{padding:"11px 16px",borderBottom:`1px solid ${e.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("span",{style:{fontSize:11,color:e.dim,...f},children:"SIGNAL HISTORY"}),n.jsx(_,{text:`${r.length} records`,color:e.dim})]}),r.slice(1).map((t,d)=>{var C,U,H,z,$,ce,de,ue,pe;const m=t.dec.action==="ACCUMULATE"?e.ok:t.dec.action==="REDUCE"?e.danger:e.warn,p=Q(t),h=(U=(C=t==null?void 0:t.dec)==null?void 0:C.audit_record)!=null&&U.decision_hash&&((H=a[String(t.dec.audit_record.decision_hash)])==null?void 0:H.result)||null,g=String(((z=t==null?void 0:t.dec)==null?void 0:z.decision_source)||(t==null?void 0:t.source)||"ai"),v=g==="hybrid-ai"?e.accent:g==="quant-core"?e.text:g==="fallback"?e.warn:e.ok;return n.jsxs("div",{style:{display:"grid",gridTemplateColumns:S,gap:10,padding:"9px 16px",borderBottom:d<r.length-2?`1px solid ${e.border}`:"none",alignItems:"center"},children:[n.jsx("span",{style:{fontSize:11,color:e.dim,...f},children:ge(t.ts)}),n.jsxs("div",{style:{display:"flex",gap:5,alignItems:"center",flexWrap:"wrap"},children:[n.jsx(_,{text:t.dec.action,color:m}),!o&&n.jsx(_,{text:g==="hybrid-ai"?"HYB":g==="quant-core"?"Q":g==="fallback"?"F":"AI",color:v}),!o&&n.jsx(_,{text:p.text,color:p.color}),!o&&n.jsx(_,{text:p.provenance.text,color:p.provenance.color}),!o&&((de=(ce=($=t==null?void 0:t.dec)==null?void 0:$.audit_record)==null?void 0:ce.crypto_signature)==null?void 0:de.status)==="signed"&&h&&n.jsx(_,{text:h.status==="verified"?"SIG✓":h.status==="unpinned"?"SIG⚠":h.status==="invalid"?"SIG✗":"SIG?",color:h.status==="verified"?e.ok:h.status==="unpinned"?e.warn:h.status==="invalid"?e.danger:e.dim})]}),!o&&n.jsxs("span",{style:{fontSize:12,color:e.text,...f},children:[t.dec.capital_allocation_kas," KAS"]}),!o&&n.jsxs("span",{style:{fontSize:12,color:t.dec.confidence_score>=.8?e.ok:e.warn,...f},children:["c:",t.dec.confidence_score]}),n.jsxs("span",{style:{fontSize:11,color:e.dim,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.dec.rationale,(pe=(ue=t==null?void 0:t.dec)==null?void 0:ue.audit_record)!=null&&pe.decision_hash?` · ${String(t.dec.audit_record.decision_hash).slice(0,12)}`:""]})]},d)})]})]})]})}export{Oe as IntelligencePanel};
