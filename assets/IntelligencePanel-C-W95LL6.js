import{r as z,j as n}from"./react-vendor-D4yGots9.js";import{a as e,m as S,b as me,C as F,B as _,d as ue,L as Y}from"./index-DKkH4U3d.js";const ye={},$=ye,de=String($.VITE_DECISION_AUDIT_SIGNER_URL||"").trim(),pe=String($.VITE_DECISION_AUDIT_SIGNER_PUBLIC_KEY_URL||"").trim(),Se=String($.VITE_DECISION_AUDIT_SIGNER_TOKEN||"").trim(),Ie=Math.max(5e3,Number($.VITE_DECISION_AUDIT_SIGNER_PUBLIC_KEY_CACHE_TTL_MS||3e5)),Ee=String($.VITE_DECISION_AUDIT_SIGNER_PINNED_FINGERPRINTS||"").split(",").map(r=>r.trim()).filter(Boolean),be=/^(1|true|yes)$/i.test(String($.VITE_DECISION_AUDIT_SIGNER_REQUIRE_PINNED||"false"));let H=null,K=null;function Q(){return Date.now()}function q(r){if(r==null)return"null";const l=typeof r;return l==="number"?Number.isFinite(r)?JSON.stringify(r):"null":l==="boolean"?r?"true":"false":l==="string"?JSON.stringify(r):Array.isArray(r)?`[${r.map(c=>q(c)).join(",")}]`:l==="object"?`{${Object.entries(r).filter(([,i])=>typeof i<"u").sort(([i],[m])=>i.localeCompare(m)).map(([i,m])=>`${JSON.stringify(i)}:${q(m)}`).join(",")}}`:"null"}function we(r){return{audit_record_version:String((r==null?void 0:r.audit_record_version)||""),hash_algo:String((r==null?void 0:r.hash_algo)||""),prompt_version:String((r==null?void 0:r.prompt_version)||""),ai_response_schema_version:String((r==null?void 0:r.ai_response_schema_version)||""),quant_feature_snapshot_hash:String((r==null?void 0:r.quant_feature_snapshot_hash)||""),decision_hash:String((r==null?void 0:r.decision_hash)||""),overlay_plan_reason:String((r==null?void 0:r.overlay_plan_reason)||""),engine_path:String((r==null?void 0:r.engine_path)||""),created_ts:Math.max(0,Math.round(Number((r==null?void 0:r.created_ts)||0)))}}function je(){if(pe)return pe;if(!de)return"";try{const r=new URL(de);return r.pathname.endsWith("/v1/audit-sign")?(r.pathname=r.pathname.replace(/\/v1\/audit-sign$/,"/v1/public-key"),r.toString()):""}catch{return""}}function ge(r){const l=String(r||"").replace(/-/g,"+").replace(/_/g,"/"),c=l.length%4===0?"":"=".repeat(4-l.length%4),i=atob(l+c),m=new Uint8Array(i.length);for(let x=0;x<i.length;x+=1)m[x]=i.charCodeAt(x);return m}function ke(r){let l="";for(let c=0;c<r.length;c+=1)l+=String.fromCharCode(r[c]);return btoa(l).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Ce(r){const l=String(r||"").replace(/-----BEGIN PUBLIC KEY-----/g,"").replace(/-----END PUBLIC KEY-----/g,"").replace(/\s+/g,"");return ge(l.replace(/\+/g,"-").replace(/\//g,"_"))}async function _e(r){const l=new TextEncoder().encode(String(r||"")),c=new Uint8Array(await crypto.subtle.digest("SHA-256",l));return ke(c)}async function W(r){return`sha256:${await _e(String(r||""))}`}function Ae(r){return(Array.isArray(r)?r:Ee).map(c=>String(c||"").trim()).filter(Boolean)}function ve(r){return String(r||"").trim().toUpperCase()}async function Ne(r,l){const c=Ce(r);if(l==="ED25519")return{key:await crypto.subtle.importKey("spki",c,{name:"Ed25519"},!1,["verify"]),verifyAlgo:{name:"Ed25519"}};if(l==="ES256")return{key:await crypto.subtle.importKey("spki",c,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),verifyAlgo:{name:"ECDSA",hash:"SHA-256"}};if(l==="RS256")return{key:await crypto.subtle.importKey("spki",c,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!1,["verify"]),verifyAlgo:{name:"RSASSA-PKCS1-v1_5"}};throw new Error(`unsupported_alg:${l||"unknown"}`)}function Te(){return!!(H&&Q()-H.ts<Ie)}async function De(r){if(Te())return H;if(K)return K;const l=String(je()).trim();return l?(K=(async()=>{try{const c={},i=String((r==null?void 0:r.token)||Se||"").trim();i&&(c.Authorization=`Bearer ${i}`);const m=await fetch(l,{headers:c}),x=await m.json().catch(()=>({}));if(!m.ok)return null;const o=x!=null&&x.key&&typeof x.key=="object"?x.key:x,E=String((o==null?void 0:o.publicKeyPem)||(o==null?void 0:o.public_key_pem)||"");if(!E.trim())return null;const I={ts:Q(),keyId:o!=null&&o.keyId?String(o.keyId):o!=null&&o.key_id?String(o.key_id):null,alg:o!=null&&o.alg?String(o.alg):o!=null&&o.algorithm?String(o.algorithm):null,publicKeyPem:E,fingerprint:typeof(o==null?void 0:o.publicKeyFingerprint)=="string"?String(o.publicKeyFingerprint):typeof(o==null?void 0:o.public_key_fingerprint)=="string"?String(o.public_key_fingerprint):await W(E)};return H=I,I}catch{return null}finally{K=null}})(),K):null}function k(r){return{status:"error",verified:!1,pinMatched:null,pinsConfigured:!1,keyFingerprint:null,keyId:null,alg:null,source:"none",verifiedAtTs:Q(),...r}}function Pe(){var r;return!!((r=globalThis.crypto)!=null&&r.subtle&&globalThis.TextEncoder&&globalThis.atob&&globalThis.btoa)}async function Be(r,l){if(!Pe())return k({status:"unsupported",detail:"webcrypto_unavailable"});const c=r==null?void 0:r.audit_record,i=c==null?void 0:c.crypto_signature;if(!c||!i||String((i==null?void 0:i.status)||"").toLowerCase()!=="signed")return k({status:"missing_signature",detail:"crypto_signature_not_signed"});const m=String((i==null?void 0:i.sig_b64u)||"").trim();if(!m)return k({status:"missing_signature",detail:"sig_b64u_missing"});const x=we(c);if(!x.decision_hash||!x.quant_feature_snapshot_hash)return k({status:"missing_payload",detail:"audit_payload_missing_hashes"});const o=q(x);let E=String((i==null?void 0:i.public_key_pem)||""),I=null,b="none",a=null;if(E.trim())b="embedded",I=await W(E);else{if(a=await De(l),!(a!=null&&a.publicKeyPem))return k({status:"error",detail:"public_key_not_available",keyId:String((i==null?void 0:i.key_id)||"")||null,alg:String((i==null?void 0:i.alg)||"")||null});E=a.publicKeyPem,I=a.fingerprint||await W(E),b="fetched"}const O=Ae(l==null?void 0:l.pinnedFingerprints),w=O.length>0,N=w?O.includes(String(I||"")):null;if(be&&w&&!N)return k({status:"unpinned",verified:!1,pinMatched:!1,pinsConfigured:w,keyFingerprint:I,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:String((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||"")||null,source:b,detail:"signer_key_not_pinned"});try{const T=String((i==null?void 0:i.payload_hash_sha256_b64u)||"").trim();if(T&&await _e(o)!==T)return k({status:"invalid",detail:"payload_hash_mismatch",keyFingerprint:I,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:String((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||"")||null,source:b,pinsConfigured:w,pinMatched:N});const C=ve((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||""),{key:y,verifyAlgo:s}=await Ne(E,C),P=await crypto.subtle.verify(s,y,ge(m),new TextEncoder().encode(o));return k({status:P?"verified":"invalid",verified:!!P,pinMatched:N,pinsConfigured:w,keyFingerprint:I,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:C||null,source:b,detail:P?void 0:"signature_verify_failed"})}catch(T){const C=String((T==null?void 0:T.message)||"verify_failed");return/unsupported_alg/i.test(C)?k({status:"unsupported",detail:C,pinMatched:N,pinsConfigured:w,keyFingerprint:I,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:String((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||"")||null,source:b}):k({status:"error",detail:C,pinMatched:N,pinsConfigured:w,keyFingerprint:I,keyId:String((i==null?void 0:i.key_id)||(a==null?void 0:a.keyId)||"")||null,alg:String((i==null?void 0:i.alg)||(a==null?void 0:a.alg)||"")||null,source:b})}}function Ue(r){const l=r==null?void 0:r.audit_record,c=l==null?void 0:l.crypto_signature,i=String((l==null?void 0:l.decision_hash)||"").trim(),m=String((c==null?void 0:c.sig_b64u)||"").trim(),x=String((c==null?void 0:c.key_id)||"").trim();return!i||!m?"":`${i}|${x}|${m.slice(0,48)}`}function ze({decisions:r,queue:l=[],loading:c,onRun:i}){var Z,X,ee,te,ne,re,ie;const[m,x]=z.useState(typeof window<"u"?window.innerWidth:1200);z.useEffect(()=>{if(typeof window>"u")return;const t=()=>x(window.innerWidth);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const o=m<760,E=o?"repeat(2,1fr)":"repeat(4,1fr)",I=o?"78px 108px 1fr":"90px 200px 96px 88px 1fr",b=Array.isArray(l)?l:[],[a,O]=z.useState({}),w=z.useRef(new Set),N=z.useMemo(()=>{var u,f;const t=new Map;for(const d of b){if(!d||(d==null?void 0:d.metaKind)==="treasury_fee")continue;const h=String(((f=(u=d==null?void 0:d.dec)==null?void 0:u.audit_record)==null?void 0:f.decision_hash)||"").trim();if(!h)continue;const g=t.get(h);(!g||Number((d==null?void 0:d.ts)||0)>Number((g==null?void 0:g.ts)||0))&&t.set(h,d)}return t},[b]),J=t=>{var d,h;if(!(t!=null&&t.dec))return null;const u=String(((h=(d=t==null?void 0:t.dec)==null?void 0:d.audit_record)==null?void 0:h.decision_hash)||"").trim();return u&&N.has(u)?N.get(u):b.filter(g=>(g==null?void 0:g.metaKind)!=="treasury_fee"&&(g==null?void 0:g.dec)===t.dec).sort((g,j)=>Number((j==null?void 0:j.ts)||0)-Number((g==null?void 0:g.ts)||0))[0]||null},T=t=>{if(!t)return{text:"ESTIMATED",color:e.warn};const u=String((t==null?void 0:t.receipt_imported_from)||"").toLowerCase(),f=String((t==null?void 0:t.receipt_source_path)||"").toLowerCase(),d=String((t==null?void 0:t.confirm_ts_source)||"").toLowerCase();return u==="callback_consumer"||f.includes("callback-consumer")?{text:"BACKEND",color:e.purple}:u==="kaspa_api"||d==="chain"?{text:"CHAIN",color:e.ok}:{text:"ESTIMATED",color:e.warn}},C=t=>{const u=J(t),f=T(u);if(!u)return{text:"SIMULATED",color:e.dim,provenance:{text:"ESTIMATED",color:e.warn}};if(String((u==null?void 0:u.status)||"")!=="signed")return{text:"ESTIMATED",color:e.warn,provenance:f};const d=String((u==null?void 0:u.receipt_lifecycle)||"submitted");return d==="confirmed"?f.text==="BACKEND"?{text:"BACKEND CONFIRMED",color:e.purple,provenance:f}:f.text==="CHAIN"?{text:"CHAIN CONFIRMED",color:e.ok,provenance:f}:{text:"ESTIMATED",color:e.warn,provenance:f}:d==="broadcasted"||d==="pending_confirm"||d==="submitted"?{text:"BROADCASTED",color:e.warn,provenance:f}:{text:"ESTIMATED",color:e.warn,provenance:f}},y=r[0],s=y==null?void 0:y.dec,P=(s==null?void 0:s.action)==="ACCUMULATE"?e.ok:(s==null?void 0:s.action)==="REDUCE"?e.danger:(s==null?void 0:s.action)==="REBALANCE"?e.purple:e.warn,R=String((s==null?void 0:s.decision_source)||(y==null?void 0:y.source)||"ai"),fe=R==="hybrid-ai"?e.accent:R==="quant-core"?e.text:R==="fallback"?e.warn:e.ok,p=(s==null?void 0:s.quant_metrics)||null,B=y?C(y):null,A=((Z=s==null?void 0:s.audit_record)==null?void 0:Z.crypto_signature)||null,D=(ee=(X=y==null?void 0:y.dec)==null?void 0:X.audit_record)!=null&&ee.decision_hash&&((te=a[String(y.dec.audit_record.decision_hash)])==null?void 0:te.result)||null,V=t=>t==null||t===""?"—":typeof t=="number"?Number.isFinite(t)?Math.abs(t)>=1e3?String(Math.round(t)):String(t):"—":typeof t=="boolean"?t?"yes":"no":String(t);z.useEffect(()=>{var f,d;let t=!1;const u=(Array.isArray(r)?r:[]).slice(0,24);for(const h of u){const g=(f=h==null?void 0:h.dec)==null?void 0:f.audit_record,j=String((g==null?void 0:g.decision_hash)||"").trim();if(!j||String(((d=g==null?void 0:g.crypto_signature)==null?void 0:d.status)||"").toLowerCase()!=="signed")continue;const v=Ue(h.dec);if(!v)continue;const U=a[j];(U==null?void 0:U.cacheKey)!==v&&(w.current.has(v)||(w.current.add(v),Be(h.dec).then(G=>{t||O(L=>{const M=L[j];return(M==null?void 0:M.cacheKey)===v?L:{...L,[j]:{cacheKey:v,result:G}}})}).finally(()=>{w.current.delete(v)})))}return()=>{t=!0}},[a,r]);const he=t=>t?t.status==="verified"?n.jsx(_,{text:"CRYPTO VERIFIED",color:e.ok}):t.status==="unpinned"?n.jsx(_,{text:"UNPINNED KEY",color:e.warn}):t.status==="invalid"?n.jsx(_,{text:"CRYPTO INVALID",color:e.danger}):t.status==="unsupported"?n.jsx(_,{text:"VERIFY UNSUPPORTED",color:e.dim}):t.status==="error"?n.jsx(_,{text:"VERIFY ERROR",color:e.warn}):n.jsx(_,{text:"VERIFY UNKNOWN",color:e.dim}):n.jsx(_,{text:"CRYPTO VERIFY…",color:e.dim}),xe=t=>{if(!t)return"crypto verify pending";const u=[`verify ${String(t.status||"unknown")}`,t.alg?String(t.alg):"",t.keyFingerprint?`fp ${String(t.keyFingerprint).slice(0,26)}`:"",t.pinMatched===!0?"pinned":t.pinMatched===!1?"unpinned":"",t.source?`src ${t.source}`:""].filter(Boolean);return t.detail&&u.push(String(t.detail).slice(0,80)),u.join(" · ")};return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",flexDirection:o?"column":"row",justifyContent:"space-between",alignItems:o?"flex-start":"center",marginBottom:16,gap:o?8:0},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:13,color:e.text,fontWeight:700,...S},children:"Quant Intelligence Layer"}),n.jsx("div",{style:{fontSize:11,color:e.dim},children:"Deterministic quant core + AI risk overlay · Kelly sizing · regime detection · execution guardrails"})]}),n.jsx(me,{onClick:i,disabled:c,children:c?"PROCESSING...":"RUN QUANT CYCLE"})]}),c&&n.jsxs(F,{p:24,style:{textAlign:"center",marginBottom:12},children:[n.jsx("div",{style:{fontSize:12,color:e.dim,...S,marginBottom:6},children:"Running quant engine..."}),n.jsx("div",{style:{fontSize:11,color:e.dim},children:"Kaspa on-chain data → Kelly sizing → Monte Carlo → Decision"})]}),!s&&!c&&n.jsxs(F,{p:40,style:{textAlign:"center",marginBottom:12},children:[n.jsx("div",{style:{fontSize:13,color:e.dim,...S,marginBottom:6},children:"No intelligence output yet."}),n.jsx("div",{style:{fontSize:12,color:e.dim},children:"Run a quant cycle to generate a structured trade decision with Kelly sizing and Monte Carlo confidence."})]}),s&&n.jsxs(n.Fragment,{children:[n.jsxs(F,{p:18,style:{marginBottom:10,border:`1px solid ${P}25`},children:[n.jsxs("div",{style:{display:"flex",alignItems:o?"flex-start":"center",justifyContent:"space-between",flexDirection:o?"column":"row",gap:o?8:0,marginBottom:14},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx(_,{text:s.action,color:P}),n.jsx(_,{text:s.strategy_phase,color:e.purple}),n.jsx(_,{text:`SOURCE ${R.toUpperCase()}`,color:fe}),B&&n.jsx(_,{text:`TRUTH ${B.text}`,color:B.color}),B&&n.jsx(_,{text:`PROV ${B.provenance.text}`,color:B.provenance.color}),(p==null?void 0:p.regime)&&n.jsx(_,{text:`REGIME ${String(p.regime).replace(/_/g," ")}`,color:e.accent}),((ne=s==null?void 0:s.audit_record)==null?void 0:ne.audit_sig)&&n.jsx(_,{text:"AUDIT READY",color:e.text}),(A==null?void 0:A.status)==="signed"&&n.jsx(_,{text:"CRYPTO SIGNED",color:e.ok}),(A==null?void 0:A.status)==="signed"&&he(D),(D==null?void 0:D.pinMatched)===!0&&n.jsx(_,{text:"KEY PINNED",color:e.accent}),(D==null?void 0:D.pinMatched)===!1&&n.jsx(_,{text:"KEY UNPINNED",color:e.warn}),(A==null?void 0:A.status)==="error"&&n.jsx(_,{text:"CRYPTO SIGN ERR",color:e.warn}),n.jsx("span",{style:{fontSize:11,color:e.dim,...S},children:ue(y.ts)})]}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx(_,{text:`CONF ${s.confidence_score}`,color:s.confidence_score>=.8?e.ok:e.warn}),n.jsx(_,{text:`RISK ${s.risk_score}`,color:s.risk_score<=.4?e.ok:s.risk_score<=.7?e.warn:e.danger})]})]}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:E,gap:10,marginBottom:14},children:[["Kelly Fraction",`${(s.kelly_fraction*100).toFixed(1)}%`,e.accent,"Position sizing fraction after quant/AI guardrails. Higher is more aggressive."],["Monte Carlo Win",`${s.monte_carlo_win_pct}%`,e.ok,"Model-estimated win probability for the current setup; not guaranteed realized PnL."],["Capital Alloc",`${s.capital_allocation_kas} KAS`,e.text,"Proposed KAS amount for this cycle after portfolio caps and risk controls."],["Expected Value",`+${s.expected_value_pct}%`,e.ok,"Expected edge for this decision before realized execution drift is known."],["Stop Loss",`-${s.stop_loss_pct}%`,e.danger,"Loss control target used for risk envelope logic."],["Take Profit",`+${s.take_profit_pct}%`,e.ok,"Profit-taking target used for expected value and phase planning."],["Volatility",s.volatility_estimate,s.volatility_estimate==="HIGH"?e.danger:s.volatility_estimate==="MEDIUM"?e.warn:e.ok,"Quant-estimated volatility bucket; high volatility tightens trust in raw signals."],["Liquidity Impact",s.liquidity_impact,s.liquidity_impact==="SIGNIFICANT"?e.danger:e.dim,"Estimated execution friction/slippage pressure for current market conditions."],["Engine Latency",`${s.engine_latency_ms||0} ms`,(s.engine_latency_ms||0)<=2500?e.ok:e.warn,"Decision engine runtime (quant + AI overlay path + fusion) for this cycle."],["Data Quality",(p==null?void 0:p.data_quality_score)??"—",((p==null?void 0:p.data_quality_score)??0)>=.75?e.ok:e.warn,"Signal trust score from quant feature sufficiency and stability. Low quality reduces automation confidence."]].map(([t,u,f,d])=>n.jsxs("div",{title:String(d),style:{background:e.s2,borderRadius:4,padding:"10px 12px"},children:[n.jsx("div",{style:{fontSize:10,color:e.dim,...S,letterSpacing:"0.06em",marginBottom:4},children:t}),n.jsx("div",{style:{fontSize:13,color:f,fontWeight:700,...S},children:u})]},t))}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:o?"1fr":"repeat(3,1fr)",gap:8,marginBottom:14},children:[["Sizing","Kelly Fraction + Capital Alloc are your practical position-size controls in KAS."],["Trust","Data Quality + Regime + Risk/Confidence tell you whether to trust the action or wait."],["Execution","Liquidity Impact + Engine Latency help explain slippage risk and cycle responsiveness."]].map(([t,u])=>n.jsxs("div",{style:{background:`linear-gradient(180deg, ${e.s2} 0%, ${e.s1} 100%)`,border:`1px solid ${e.border}`,borderRadius:6,padding:"9px 10px"},children:[n.jsx("div",{style:{fontSize:10,color:e.accent,...S,marginBottom:3},children:t}),n.jsx("div",{style:{fontSize:11,color:e.dim,lineHeight:1.35},children:u})]},String(t)))}),n.jsxs("div",{style:{background:e.s2,borderRadius:4,padding:"10px 14px",marginBottom:12},children:[n.jsx(Y,{children:"Decision Rationale"}),n.jsx("div",{style:{fontSize:13,color:e.text,lineHeight:1.5},children:s.rationale}),s.decision_source_detail&&n.jsxs("div",{style:{fontSize:11,color:e.dim,marginTop:8,...S},children:["source detail: ",s.decision_source_detail]}),s.audit_record&&n.jsxs("div",{style:{fontSize:11,color:e.dim,marginTop:8,...S,lineHeight:1.5},children:[n.jsxs("div",{children:["audit: ",String(s.audit_record.audit_record_version||"—")," · prompt ",String(s.audit_record.prompt_version||"—")," · schema ",String(s.audit_record.ai_response_schema_version||"—")]}),n.jsxs("div",{children:["qhash ",String(s.audit_record.quant_feature_snapshot_hash||"—").slice(0,22),"… · dhash ",String(s.audit_record.decision_hash||"—").slice(0,22),"… · sig ",String(s.audit_record.audit_sig||"—").slice(0,18),"…"]}),s.audit_record.crypto_signature&&n.jsxs("div",{children:["crypto ",String(s.audit_record.crypto_signature.status||"unknown")," · ",String(s.audit_record.crypto_signature.alg||"—")," · key ",String(s.audit_record.crypto_signature.key_id||"—").slice(0,22)]}),((re=s.audit_record.crypto_signature)==null?void 0:re.status)==="signed"&&n.jsx("div",{children:xe(D)})]})]}),((ie=s.risk_factors)==null?void 0:ie.length)>0&&n.jsxs("div",{style:{marginBottom:12},children:[n.jsx(Y,{children:"Risk Factors"}),n.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:s.risk_factors.map((t,u)=>n.jsx(_,{text:t,color:e.warn},u))})]}),n.jsxs("div",{style:{background:e.aLow,borderRadius:4,padding:"10px 14px"},children:[n.jsx(Y,{color:e.accent,children:"Next Review Trigger"}),n.jsx("div",{style:{fontSize:12,color:e.text},children:s.next_review_trigger})]})]}),p&&n.jsxs(F,{p:18,style:{marginBottom:10},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:8,flexWrap:"wrap"},children:[n.jsx(Y,{children:"Quant Core Diagnostics"}),n.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[n.jsx(_,{text:`SAMPLES ${V(p.sample_count)}`,color:e.dim}),n.jsx(_,{text:`EDGE ${V(p.edge_score)}`,color:(Number(p.edge_score)||0)>0?e.ok:e.warn}),p.ai_overlay_applied&&n.jsx(_,{text:"AI OVERLAY APPLIED",color:e.accent})]})]}),n.jsx("div",{style:{fontSize:11,color:e.dim,marginBottom:10},children:"Raw quant features behind the decision. Use these to understand regime behavior and why guardrails or AI fusion changed sizing/action."}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:o?"1fr":"1fr 1fr",gap:8},children:[["Risk Profile",p.risk_profile],["Risk Ceiling",p.risk_ceiling],["Kelly Cap",p.kelly_cap],["Price USD",p.price_usd],["1-step Return %",p.price_return_1_pct],["5-step Return %",p.price_return_5_pct],["20-step Return %",p.price_return_20_pct],["Momentum Z",p.momentum_z],["EWMA Volatility",p.ewma_volatility],["DAA Velocity",p.daa_velocity],["DAA Slope",p.daa_slope],["Drawdown %",p.drawdown_pct],["Model Win Prob",p.win_probability_model],["Exposure Cap %",p.exposure_cap_pct]].map(([t,u])=>n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10,background:e.s2,borderRadius:4,padding:"9px 12px"},children:[n.jsx("span",{style:{fontSize:11,color:e.dim,...S},children:t}),n.jsx("span",{style:{fontSize:11,color:e.text,...S},children:V(u)})]},String(t)))})]}),r.length>1&&n.jsxs(F,{p:0,children:[n.jsx("div",{style:{padding:"11px 16px",borderBottom:`1px solid ${e.border}`},children:n.jsxs("span",{style:{fontSize:11,color:e.dim,...S},children:["DECISION HISTORY — ",r.length," records"]})}),r.slice(1).map((t,u)=>{var U,G,L,M,se,oe,ae,le,ce;const f=t.dec.action==="ACCUMULATE"?e.ok:t.dec.action==="REDUCE"?e.danger:e.warn,d=C(t),h=(G=(U=t==null?void 0:t.dec)==null?void 0:U.audit_record)!=null&&G.decision_hash&&((L=a[String(t.dec.audit_record.decision_hash)])==null?void 0:L.result)||null,g=String(((M=t==null?void 0:t.dec)==null?void 0:M.decision_source)||(t==null?void 0:t.source)||"ai"),j=g==="hybrid-ai"?"HYB":g==="quant-core"?"Q":g==="fallback"?"F":"AI",v=g==="hybrid-ai"?e.accent:g==="quant-core"?e.text:g==="fallback"?e.warn:e.ok;return n.jsxs("div",{style:{display:"grid",gridTemplateColumns:I,gap:10,padding:"9px 16px",borderBottom:`1px solid ${e.border}`,alignItems:"center"},children:[n.jsx("span",{style:{fontSize:11,color:e.dim,...S},children:ue(t.ts)}),n.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:[n.jsx(_,{text:t.dec.action,color:f}),!o&&n.jsx(_,{text:j,color:v}),!o&&n.jsx(_,{text:d.text,color:d.color}),!o&&n.jsx(_,{text:d.provenance.text,color:d.provenance.color}),!o&&((ae=(oe=(se=t==null?void 0:t.dec)==null?void 0:se.audit_record)==null?void 0:oe.crypto_signature)==null?void 0:ae.status)==="signed"&&h&&n.jsx(_,{text:h.status==="verified"?"SIG✓":h.status==="unpinned"?"SIG⚠":h.status==="invalid"?"SIG✗":"SIG?",color:h.status==="verified"?e.ok:h.status==="unpinned"?e.warn:h.status==="invalid"?e.danger:e.dim})]}),!o&&n.jsxs("span",{style:{fontSize:12,color:e.text,...S},children:[t.dec.capital_allocation_kas," KAS"]}),!o&&n.jsxs("span",{style:{fontSize:12,color:t.dec.confidence_score>=.8?e.ok:e.warn,...S},children:["c:",t.dec.confidence_score]}),n.jsxs("span",{style:{fontSize:11,color:e.dim,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.dec.rationale,(ce=(le=t==null?void 0:t.dec)==null?void 0:le.audit_record)!=null&&ce.decision_hash?` · ${String(t.dec.audit_record.decision_hash).slice(0,12)}`:""]})]},u)})]})]})]})}export{ze as IntelligencePanel};
