import{j as e}from"./react-vendor-D4yGots9.js";import{a as t,m as l,b as C,C as j,L as A,B as r,I as c}from"./index-DKkH4U3d.js";function x(p,h=1){return`${Number(p||0).toFixed(h)}%`}function B({agents:p,activeAgentId:h,walletKas:y,summary:i,config:n,onConfigPatch:g,onAgentOverridePatch:o,onSelectAgent:b,onRefresh:S}){const m=Array.isArray(i==null?void 0:i.rows)?i.rows:[],v=[["Wallet KAS",`${Number(y||0).toFixed(4)}`,t.accent,"Current wallet balance seen by the portfolio allocator. This is the funding pool the bot can work from."],["Allocatable",`${Number((i==null?void 0:i.allocatableKas)||0).toFixed(4)} KAS`,t.text,"KAS available for bot allocation after reserves and allocator guards."],["Target Budget",`${Number((i==null?void 0:i.targetBudgetKas)||0).toFixed(4)} KAS`,t.ok,"Allocator target pool for all agents this cycle based on budget settings and wallet size."],["Allocated",`${Number((i==null?void 0:i.allocatedKas)||0).toFixed(4)} KAS`,t.text,"Total KAS currently assigned across agent budgets/cycle caps."],["Utilization",x(i==null?void 0:i.utilizationPct,1),((i==null?void 0:i.utilizationPct)||0)>=95?t.ok:t.warn,"How much of the target budget is actually allocated. Low utilization can indicate risk/truth/calibration throttling."],["Concentration",x(i==null?void 0:i.concentrationPct,1),((i==null?void 0:i.concentrationPct)||0)>55?t.warn:t.ok,"Largest single-agent share of the allocated budget. High concentration increases single-strategy risk."],["RW Exposure",x(Number((i==null?void 0:i.riskWeightedExposurePct)||0)*100,1),t.warn,"Risk-weighted exposure proxy across all agents (higher means more aggregate aggressiveness)."],["Agents",String(Array.isArray(p)?p.length:0),t.dim,"Number of agents participating in the shared allocator."]];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,flexWrap:"wrap",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,color:t.text,fontWeight:700,...l},children:"Multi-Agent Portfolio Control"}),e.jsx("div",{style:{fontSize:11,color:t.dim},children:"Fund the bot in KAS and the allocator distributes cycle caps across agents automatically using calibration, truth quality, and risk controls."})]}),e.jsx(C,{onClick:S,size:"sm",variant:"ghost",children:"REFRESH ALLOCATOR"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:8,marginBottom:12},children:[["Capital","Wallet KAS + Allocatable tell you how much the bot can deploy this cycle."],["Safety","Concentration + RW Exposure explain portfolio risk concentration across all agents."],["Automation","Calibration/truth quality can reduce allocations even when balance is available."]].map(([a,d])=>e.jsxs("div",{style:{background:`linear-gradient(180deg, ${t.s2} 0%, ${t.s1} 100%)`,border:`1px solid ${t.border}`,borderRadius:6,padding:"9px 10px"},children:[e.jsx("div",{style:{fontSize:10,color:t.accent,...l,marginBottom:3},children:a}),e.jsx("div",{style:{fontSize:11,color:t.dim,lineHeight:1.35},children:d})]},String(a)))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:10,marginBottom:12},children:v.map(([a,d,u,f])=>e.jsxs(j,{p:12,title:f,children:[e.jsx("div",{style:{fontSize:10,color:t.dim,...l,marginBottom:4},children:a}),e.jsx("div",{style:{fontSize:13,color:u,fontWeight:700,...l},children:d})]},String(a)))}),e.jsx(j,{p:14,style:{marginBottom:12},children:e.jsxs("details",{children:[e.jsxs("summary",{style:{cursor:"pointer",listStyle:"none",display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[e.jsxs("div",{children:[e.jsx(A,{children:"Allocator Controls (Advanced)"}),e.jsx("div",{style:{fontSize:11,color:t.dim,marginTop:4},children:"Optional tuning for shared portfolio behavior. Default auto settings are fine for most operators."})]}),e.jsx(r,{text:"ADVANCED",color:t.dim})]}),e.jsxs("div",{style:{marginTop:10,display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))",gap:10},children:[e.jsx(c,{label:"Total Budget %",value:String(Math.round(Number((n==null?void 0:n.totalBudgetPct)||0)*1e4)/100),onChange:a=>g({totalBudgetPct:Math.max(5,Math.min(100,Number(a)||0))/100}),type:"number",suffix:"%",hint:"Share of wallet balance allocator can assign."}),e.jsx(c,{label:"Reserve",value:String((n==null?void 0:n.reserveKas)??0),onChange:a=>g({reserveKas:Math.max(0,Number(a)||0)}),type:"number",suffix:"KAS",hint:"Hard reserve before shared budget allocation."}),e.jsx(c,{label:"Max Agent Share %",value:String(Math.round(Number((n==null?void 0:n.maxAgentAllocationPct)||0)*1e4)/100),onChange:a=>g({maxAgentAllocationPct:Math.max(5,Math.min(100,Number(a)||0))/100}),type:"number",suffix:"%",hint:"Concentration cap per agent in shared budget."}),e.jsx(c,{label:"Rebalance Threshold %",value:String(Math.round(Number((n==null?void 0:n.rebalanceThresholdPct)||0)*1e4)/100),onChange:a=>g({rebalanceThresholdPct:Math.max(1,Math.min(50,Number(a)||0))/100}),type:"number",suffix:"%",hint:"Only surface rebalance deltas above this threshold."})]})]})}),e.jsxs(j,{p:0,children:[e.jsx("div",{style:{padding:"11px 16px",borderBottom:`1px solid ${t.border}`},children:e.jsx("span",{style:{fontSize:11,color:t.dim,...l},children:"PORTFOLIO AGENTS â€” SHARED RISK BUDGET + CAPITAL ALLOCATOR"})}),m.length===0&&e.jsx("div",{style:{padding:16,fontSize:12,color:t.dim},children:"No agents available for allocation."}),m.map(a=>{const d=a.agentId===h,u=a.risk<=.4?t.ok:a.risk<=.7?t.warn:t.danger,f=a.action==="ACCUMULATE"?t.ok:a.action==="REDUCE"?t.danger:t.warn;return e.jsxs("div",{style:{padding:"12px 14px",borderBottom:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:10,flexWrap:"wrap",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>b==null?void 0:b(a.agentId),style:{background:d?t.aLow:"transparent",border:`1px solid ${d?t.accent:t.border}`,color:d?t.accent:t.text,borderRadius:6,padding:"4px 8px",cursor:"pointer",fontSize:11,...l},children:a.name}),e.jsx(r,{text:a.enabled?"ENABLED":"DISABLED",color:a.enabled?t.ok:t.dim}),e.jsx(r,{text:`TPL ${String(a.strategyTemplate||"custom").toUpperCase()}`,color:t.dim}),e.jsx(r,{text:a.action,color:f}),e.jsx(r,{text:String(a.regime).replace(/_/g," "),color:t.accent}),e.jsx(r,{text:`RISK ${a.risk}`,color:u}),e.jsx(r,{text:`CAL ${String(a.calibrationTier||"healthy").toUpperCase()} ${Number(a.calibrationHealth||0).toFixed(2)}`,color:a.calibrationTier==="critical"?t.danger:a.calibrationTier==="degraded"||a.calibrationTier==="watch"?t.warn:t.ok})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[e.jsx(r,{text:`BUDGET ${a.budgetKas} KAS`,color:t.text}),e.jsx(r,{text:`CYCLE CAP ${a.cycleCapKas} KAS`,color:t.ok}),e.jsx(r,{text:`CAP ${Number(a.maxShareCapPct||0).toFixed(1)}%`,color:t.dim}),e.jsx(r,{text:`ALIGN x${Number(a.templateRegimeMultiplier||1).toFixed(2)}`,color:Number(a.templateRegimeMultiplier||1)>=1?t.ok:t.warn}),a.rebalanceDeltaKas!==0&&e.jsx(r,{text:`REBAL ${a.rebalanceDeltaKas>0?"+":""}${a.rebalanceDeltaKas} KAS`,color:a.rebalanceDeltaKas>0?t.ok:t.warn})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(150px,1fr))",gap:8,marginBottom:8},children:[e.jsxs("div",{title:"Allocator target share for this agent before risk/calibration/truth penalties and cycle caps.",style:{background:t.s2,borderRadius:6,padding:"8px 10px"},children:[e.jsx("div",{style:{fontSize:10,color:t.dim,...l,marginBottom:2},children:"Target Alloc"}),e.jsx("div",{style:{fontSize:12,color:t.text,...l},children:x(a.targetPct,1)})]}),e.jsxs("div",{title:"Actual budget share assigned after shared portfolio allocator weighting and caps.",style:{background:t.s2,borderRadius:6,padding:"8px 10px"},children:[e.jsx("div",{style:{fontSize:10,color:t.dim,...l,marginBottom:2},children:"Budget Share"}),e.jsx("div",{style:{fontSize:12,color:t.text,...l},children:x(a.budgetPct,1)})]}),e.jsxs("div",{title:"Relative allocator priority for this agent when conditions are favorable. Higher means more share before safety penalties.",style:{background:t.s2,borderRadius:6,padding:"8px 10px"},children:[e.jsx("div",{style:{fontSize:10,color:t.dim,...l,marginBottom:2},children:"Allocator Weight"}),e.jsx("div",{style:{fontSize:12,color:t.text,...l},children:a.riskWeight})]}),e.jsxs("div",{title:"Backlog pressure from queue items for this agent. Higher pressure can reduce new cycle allocation.",style:{background:t.s2,borderRadius:6,padding:"8px 10px"},children:[e.jsx("div",{style:{fontSize:10,color:t.dim,...l,marginBottom:2},children:"Queue Pressure"}),e.jsx("div",{style:{fontSize:12,color:a.queuePressurePct>20?t.warn:t.dim,...l},children:x(a.queuePressurePct,1)})]}),e.jsxs("div",{title:"Signal confidence and feature data quality feeding the shared allocator quality score for this agent.",style:{background:t.s2,borderRadius:6,padding:"8px 10px"},children:[e.jsx("div",{style:{fontSize:10,color:t.dim,...l,marginBottom:2},children:"Confidence / DataQ"}),e.jsxs("div",{style:{fontSize:12,color:t.text,...l},children:[a.confidence," / ",a.dataQuality]})]}),e.jsxs("div",{title:"Truth quality (receipt consistency/coverage) and calibration health directly affect allocator routing and cycle caps.",style:{background:t.s2,borderRadius:6,padding:"8px 10px"},children:[e.jsx("div",{style:{fontSize:10,color:t.dim,...l,marginBottom:2},children:"Truth Quality / Cal"}),e.jsxs("div",{style:{fontSize:12,color:t.text,...l},children:[a.truthQualityScore," / ",a.calibrationHealth]})]})]}),e.jsxs("details",{children:[e.jsxs("summary",{style:{cursor:"pointer",listStyle:"none",display:"flex",alignItems:"center",gap:8,fontSize:11,color:t.dim,...l,marginBottom:8},children:[e.jsx(r,{text:"ADVANCED AGENT OVERRIDES",color:t.dim}),e.jsx("span",{children:"Enable / allocation / allocator weight"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))",gap:10},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:11,color:t.dim,...l},children:[e.jsx("input",{type:"checkbox",checked:a.enabled,onChange:s=>o==null?void 0:o(a.agentId,{enabled:s.target.checked})}),"ENABLED"]})}),e.jsx(c,{label:"Target Allocation %",value:String(a.targetPct),onChange:s=>o==null?void 0:o(a.agentId,{targetAllocationPct:Math.max(0,Math.min(100,Number(s)||0))}),type:"number",suffix:"%",hint:"Portfolio target share for this agent."}),e.jsx(c,{label:"Allocator Weight",value:String(a.riskWeight),onChange:s=>o==null?void 0:o(a.agentId,{riskWeight:Math.max(0,Math.min(10,Number(s)||0))}),type:"number",hint:"Relative allocator weight when signals are favorable."})]})]}),e.jsx("div",{style:{marginTop:6,display:"flex",flexWrap:"wrap",gap:6},children:(a.notes||[]).map(s=>e.jsx(r,{text:s.toUpperCase(),color:t.warn},`${a.agentId}:${s}`))})]},a.agentId)})]})]})}export{B as PortfolioPanel};
