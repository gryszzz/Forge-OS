import{r as T,j as r}from"./react-vendor-D4yGots9.js";import{m as h,a as t,C as L,L as E,B as z}from"./index-zQQPrBrG.js";import"./recharts-vendor-DS4t48dv.js";import"./d3-render-vendor-RkpHolfk.js";import"./d3-scale-vendor-BynLqmir.js";let ae=0;function le(a,i){const m=T.useRef(null),[D,y]=T.useState({metrics:null,indicators:null,busy:!1,error:null});return T.useEffect(()=>{try{m.current=new Worker(new URL("/assets/analyticsEngine.worker-PP9pHLQg.js",import.meta.url),{type:"module"}),m.current.onmessage=f=>{const e=f.data;e&&(e.ok?y({metrics:e.metrics,indicators:e.indicators,busy:!1,error:null}):y(s=>({...s,busy:!1,error:String(e.error||"worker error")})))},m.current.onerror=f=>{y(e=>({...e,busy:!1,error:String(f.message||"worker crashed")}))}}catch{}return()=>{var f;(f=m.current)==null||f.terminate()}},[]),T.useEffect(()=>{if(!m.current)return;const f=++ae;y(e=>({...e,busy:!0,error:null})),m.current.postMessage({id:f,decisions:a,queue:i})},[a,i]),D}function ce(a,i){var V,H,N,K,_,G,Q,X,Y,J,Z,q;if(!a||a.length===0)return{totalDecisions:0,accumulateCount:0,reduceCount:0,holdCount:0,rebalanceCount:0,winRate:0,avgConfidence:0,avgKelly:0,sharpeRatio:0,sortinoRatio:0,maxDrawdown:0,profitFactor:0,calmarRatio:0,avgWinPct:0,avgLossPct:0,streakWins:0,streakLosses:0,realizedPnl:0,unrealizedPnl:0,var95:0,cvar95:0};const m=a.filter(n=>{var o;return((o=n.dec)==null?void 0:o.action)==="ACCUMULATE"}),D=a.filter(n=>{var o;return((o=n.dec)==null?void 0:o.action)==="REDUCE"}),y=a.filter(n=>{var o;return((o=n.dec)==null?void 0:o.action)==="HOLD"}),f=a.filter(n=>{var o;return((o=n.dec)==null?void 0:o.action)==="REBALANCE"}),e=[];for(const n of a){const o=(H=(V=n==null?void 0:n.dec)==null?void 0:V.audit_record)==null?void 0:H.decision_hash;if(o){const u=i.find(w=>{var $,ee;return((ee=($=w==null?void 0:w.dec)==null?void 0:$.audit_record)==null?void 0:ee.decision_hash)===o&&(w.status==="confirmed"||w.receipt_lifecycle==="confirmed")});u&&e.push({decision:n,tx:u})}}let s=0,S=0,j=0,C=0;for(let n=0;n<e.length-1;n++){const o=e[n],u=e[n+1];if(((N=o.decision.dec)==null?void 0:N.action)==="ACCUMULATE"){const w=((K=o.decision.kasData)==null?void 0:K.priceUsd)||0,$=((G=(_=u==null?void 0:u.decision)==null?void 0:_.kasData)==null?void 0:G.priceUsd)||w;$>w?(s++,j+=($-w)/w):$<w&&(S++,C+=(w-$)/w)}}const v=s+S,R=v>0?s/v*100:50,g=[];for(let n=1;n<a.length;n++){const o=((X=(Q=a[n-1])==null?void 0:Q.kasData)==null?void 0:X.priceUsd)||0,u=((J=(Y=a[n])==null?void 0:Y.kasData)==null?void 0:J.priceUsd)||0;o>0&&g.push((u-o)/o)}const c=a.reduce((n,o)=>{var u;return n+(((u=o.dec)==null?void 0:u.confidence_score)||0)},0)/a.length,x=a.reduce((n,o)=>{var u;return n+(((u=o.dec)==null?void 0:u.kelly_fraction)||0)},0)/a.length;let d=0,b=0;for(const n of a){const o=((Z=n==null?void 0:n.kasData)==null?void 0:Z.priceUsd)||0;if(o>0){o>b&&(b=o);const u=(b-o)/b;u>d&&(d=u)}}const A=g.length>0?g.reduce((n,o)=>n+o,0)/g.length:0,l=g.length>1?Math.sqrt(g.reduce((n,o)=>n+Math.pow(o-A,2),0)/(g.length-1)):0,p=l>0?A/l*Math.sqrt(252):0,P=g.filter(n=>n<0),W=P.length>0?Math.sqrt(P.reduce((n,o)=>n+o*o,0)/P.length):0,te=W>0?A/W*Math.sqrt(252):0,re=d>0?A*252/d:0,ne=C>0?j/C:j>0?999:0,oe=s>0?j/s*100:0,ie=S>0?C/S*100:0,F=[...g].sort((n,o)=>n-o),I=Math.floor(g.length*.05),se=g.length>I?Math.abs(F[I]||0):.05;let O=0;if(g.length>I){const n=F.slice(0,I+1);O=Math.abs(n.reduce((o,u)=>o+u,0)/n.length)}let B=0,U=0,k=0,M=null;for(const n of a){const o=(q=n.dec)==null?void 0:q.action;o==="ACCUMULATE"?(M==="win"||M===null?(k++,k>B&&(B=k)):k=1,M="win"):(o==="REDUCE"||o==="HOLD")&&(M==="loss"||M===null?(k++,k>U&&(U=k)):k=1,M="loss")}return{totalDecisions:a.length,accumulateCount:m.length,reduceCount:D.length,holdCount:y.length,rebalanceCount:f.length,winRate:R,avgConfidence:c,avgKelly:x,sharpeRatio:p,sortinoRatio:te,maxDrawdown:d*100,profitFactor:ne,calmarRatio:re,avgWinPct:oe,avgLossPct:ie,streakWins:B,streakLosses:U,realizedPnl:0,unrealizedPnl:0,var95:se*100,cvar95:O*100}}function de(a){if(!a||a.length<20)return null;const i=a.map(l=>{var p;return(p=l==null?void 0:l.kasData)==null?void 0:p.priceUsd}).filter(l=>l&&l>0);if(i.length<20)return null;const m=14;let D=0,y=0;for(let l=i.length-m;l<i.length-1;l++){const p=i[l+1]-i[l];p>0?D+=p:y+=Math.abs(p)}const f=D/m,e=y/m,S=100-100/(1+(e>0?f/e:100)),j=i.slice(-20).reduce((l,p)=>l+p,0)/Math.min(20,i.length),C=i.length>=50?i.slice(-50).reduce((l,p)=>l+p,0)/50:j,v=i[i.length-1],R=(v-j)/j*100,g=(v-C)/C*100,c=i[i.length-1]>i[Math.max(0,i.length-5)]?"BULLISH":"BEARISH",x=i[i.length-1]>i[Math.max(0,i.length-20)]?"BULLISH":"BEARISH",d=[];for(let l=1;l<i.length;l++)d.push((i[l]-i[l-1])/i[l-1]);const b=d.reduce((l,p)=>l+p,0)/d.length,A=Math.sqrt(d.reduce((l,p)=>l+Math.pow(p-b,2),0)/d.length)*Math.sqrt(252)*100;return{rsi:Math.round(S*10)/10,sma20:Math.round(j*1e5)/1e5,sma50:Math.round(C*1e5)/1e5,priceVsSma20:Math.round(R*100)/100,priceVsSma50:Math.round(g*100)/100,shortTermTrend:c,mediumTermTrend:x,volatility:Math.round(A*100)/100,currentPrice:Math.round(v*1e5)/1e5,priceChange24h:Math.round((i[i.length-1]-i[Math.max(0,i.length-24)])/i[Math.max(0,i.length-24)]*100*100)/100}}function fe({decisions:a=[],queue:i=[]}){const[m,D]=T.useState(typeof window<"u"?window.innerWidth:1200);T.useEffect(()=>{if(typeof window>"u")return;const c=()=>D(window.innerWidth);return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]);const y=m<760,f=le(a,i),e=f.metrics??ce(a,i),s=f.indicators??de(a),S=(c,x,d)=>c>=x?t.ok:c<=d?t.danger:t.warn,j=(c,x)=>c>=x.excellent?{label:"EXCELLENT",color:t.ok}:c>=x.good?{label:"GOOD",color:t.accent}:c>=x.fair?{label:"FAIR",color:t.warn}:{label:"NEEDS WORK",color:t.danger},C=(c,x)=>c<=x.excellent?{label:"EXCELLENT",color:t.ok}:c<=x.good?{label:"GOOD",color:t.accent}:c<=x.fair?{label:"FAIR",color:t.warn}:{label:"NEEDS WORK",color:t.danger},v=j(e.sharpeRatio,{excellent:2,good:1,fair:.5}),R=j(e.winRate,{excellent:60,good:55,fair:50}),g=e.totalDecisions===0?{label:"NO DATA",color:t.dim}:C(e.maxDrawdown,{excellent:10,good:15,fair:25});return r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:16},children:[r.jsx("div",{style:{fontSize:13,color:t.text,fontWeight:700,...h},children:"Quant Analytics Dashboard"}),r.jsx("div",{style:{fontSize:11,color:t.dim},children:"Performance metrics, advanced indicators, and profit tracking"})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:y?"1fr":"repeat(3, 1fr)",gap:12,marginBottom:16},children:[r.jsxs(L,{p:16,style:{border:`1px solid ${v.color}40`,background:`linear-gradient(135deg, ${v.color}14 0%, ${t.s1} 100%)`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx(E,{children:"Performance Score"}),r.jsx(z,{text:v.label,color:v.color})]}),r.jsx("div",{style:{fontSize:32,fontWeight:700,color:v.color,...h,letterSpacing:"-0.02em"},children:e.totalDecisions>0?e.sharpeRatio.toFixed(2):"—"}),r.jsx("div",{style:{fontSize:10,color:t.dim,...h,marginTop:4},children:"Sharpe Ratio · target 2.0+"})]}),r.jsxs(L,{p:16,style:{border:`1px solid ${R.color}40`,background:`linear-gradient(135deg, ${R.color}14 0%, ${t.s1} 100%)`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx(E,{children:"Win Rate"}),r.jsx(z,{text:R.label,color:R.color})]}),r.jsx("div",{style:{fontSize:32,fontWeight:700,color:R.color,...h,letterSpacing:"-0.02em"},children:e.totalDecisions>0?`${e.winRate.toFixed(1)}%`:"—"}),r.jsx("div",{style:{fontSize:10,color:t.dim,...h,marginTop:4},children:"Decision accuracy · target 55%+"})]}),r.jsxs(L,{p:16,style:{border:`1px solid ${g.color}40`,background:`linear-gradient(135deg, ${g.color}14 0%, ${t.s1} 100%)`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx(E,{children:"Max Drawdown"}),r.jsx(z,{text:g.label,color:g.color})]}),r.jsx("div",{style:{fontSize:32,fontWeight:700,color:g.color,...h,letterSpacing:"-0.02em"},children:e.totalDecisions>0?`-${e.maxDrawdown.toFixed(1)}%`:"—"}),r.jsx("div",{style:{fontSize:10,color:t.dim,...h,marginTop:4},children:"Peak-to-trough · target <15%"})]})]}),r.jsxs(L,{p:18,style:{marginBottom:12},children:[r.jsx(E,{style:{marginBottom:12},children:"Key Performance Metrics"}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:y?"repeat(2, 1fr)":"repeat(4, 1fr)",gap:10},children:[["Total Decisions",e.totalDecisions,t.text],["ACCUMULATE",e.accumulateCount,t.ok],["REDUCE",e.reduceCount,t.danger],["HOLD",e.holdCount,t.warn],["Avg Confidence",e.totalDecisions>0?`${(e.avgConfidence*100).toFixed(0)}%`:"—",e.avgConfidence>=.75?t.ok:t.warn],["Avg Kelly",e.totalDecisions>0?`${(e.avgKelly*100).toFixed(1)}%`:"—",t.accent],["Sortino Ratio",e.totalDecisions>0?e.sortinoRatio.toFixed(2):"—",S(e.sortinoRatio,3,.5)],["Calmar Ratio",e.totalDecisions>0?e.calmarRatio.toFixed(2):"—",S(e.calmarRatio,2,.5)],["Profit Factor",e.totalDecisions>0?e.profitFactor.toFixed(2):"—",S(e.profitFactor,2,1)],["Avg Win",e.avgWinPct>0?`+${e.avgWinPct.toFixed(2)}%`:"—",t.ok],["Avg Loss",e.avgLossPct>0?`-${e.avgLossPct.toFixed(2)}%`:"—",t.danger],["Win Streak",e.streakWins,t.ok],["Loss Streak",e.streakLosses,t.danger],["VaR (95%)",e.var95>0?`-${e.var95.toFixed(2)}%`:"—",t.warn],["CVaR (95%)",e.cvar95>0?`-${e.cvar95.toFixed(2)}%`:"—",t.danger]].map(([c,x,d])=>r.jsxs("div",{style:{background:`linear-gradient(135deg, ${d}08 0%, ${t.s2} 100%)`,border:`1px solid ${d}18`,borderRadius:6,padding:"10px 12px"},children:[r.jsx("div",{style:{fontSize:10,color:t.dim,...h,marginBottom:4},children:String(c)}),r.jsx("div",{style:{fontSize:14,color:d,fontWeight:700,...h},children:String(x)})]},String(c)))})]}),s&&r.jsxs(L,{p:18,style:{marginBottom:12},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[r.jsx(E,{children:"Advanced Technical Indicators"}),r.jsx(z,{text:"LIVE",color:t.ok,dot:!0})]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:y?"repeat(2, 1fr)":"repeat(4, 1fr)",gap:10,marginBottom:16},children:[["RSI (14)",s.rsi,s.rsi>70?t.danger:s.rsi<30?t.ok:t.text,s.rsi>70?"OVERBOUGHT":s.rsi<30?"OVERSOLD":"NEUTRAL"],["SMA (20)",s.sma20,t.text,`Price ${s.priceVsSma20>=0?"+":""}${s.priceVsSma20}%`],["SMA (50)",s.sma50,t.text,`Price ${s.priceVsSma50>=0?"+":""}${s.priceVsSma50}%`],["24h Change",`${s.priceChange24h>=0?"+":""}${s.priceChange24h}%`,s.priceChange24h>0?t.ok:t.danger,s.priceChange24h>0?"GAIN":"LOSS"]].map(([c,x,d,b])=>r.jsxs("div",{style:{background:`linear-gradient(135deg, ${d}10 0%, ${t.s2} 100%)`,border:`1px solid ${d}20`,borderRadius:6,padding:"12px 14px"},children:[r.jsx("div",{style:{fontSize:10,color:t.dim,...h,marginBottom:4},children:String(c)}),r.jsx("div",{style:{fontSize:16,color:d,fontWeight:700,...h},children:String(x)}),b&&r.jsx("div",{style:{fontSize:10,color:t.dim,...h,marginTop:2},children:String(b)})]},String(c)))}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[r.jsx(z,{text:`TREND: ${s.shortTermTrend}`,color:s.shortTermTrend==="BULLISH"?t.ok:t.danger}),r.jsx(z,{text:`MEDIUM: ${s.mediumTermTrend}`,color:s.mediumTermTrend==="BULLISH"?t.ok:t.danger}),r.jsx(z,{text:`VOLATILITY: ${s.volatility.toFixed(1)}%`,color:s.volatility<30?t.ok:s.volatility<60?t.warn:t.danger})]})]}),!s&&e.totalDecisions>0&&r.jsxs(L,{p:18,style:{marginBottom:12,textAlign:"center"},children:[r.jsx("div",{style:{fontSize:12,color:t.dim,...h},children:"Collecting more data points for advanced indicators..."}),r.jsx("div",{style:{fontSize:11,color:t.dim,...h,marginTop:4},children:"Need at least 20 decisions with price data"})]}),e.totalDecisions>0&&r.jsxs(L,{p:18,style:{marginBottom:12},children:[r.jsx(E,{style:{marginBottom:12},children:"Decision Distribution"}),r.jsxs("div",{style:{display:"flex",height:24,borderRadius:4,overflow:"hidden",marginBottom:12},children:[e.accumulateCount>0&&r.jsx("div",{style:{width:`${e.accumulateCount/e.totalDecisions*100}%`,background:t.ok,display:"flex",alignItems:"center",justifyContent:"center"},children:e.accumulateCount/e.totalDecisions>.1&&r.jsx("span",{style:{fontSize:10,color:t.s1,...h},children:"ACC"})}),e.reduceCount>0&&r.jsx("div",{style:{width:`${e.reduceCount/e.totalDecisions*100}%`,background:t.danger,display:"flex",alignItems:"center",justifyContent:"center"},children:e.reduceCount/e.totalDecisions>.1&&r.jsx("span",{style:{fontSize:10,color:t.s1,...h},children:"RED"})}),e.holdCount>0&&r.jsx("div",{style:{width:`${e.holdCount/e.totalDecisions*100}%`,background:t.warn,display:"flex",alignItems:"center",justifyContent:"center"},children:e.holdCount/e.totalDecisions>.1&&r.jsx("span",{style:{fontSize:10,color:t.s1,...h},children:"HOLD"})}),e.rebalanceCount>0&&r.jsx("div",{style:{width:`${e.rebalanceCount/e.totalDecisions*100}%`,background:t.purple,display:"flex",alignItems:"center",justifyContent:"center"},children:e.rebalanceCount/e.totalDecisions>.1&&r.jsx("span",{style:{fontSize:10,color:t.s1,...h},children:"REB"})})]}),r.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",fontSize:11,...h},children:[r.jsxs("span",{style:{color:t.ok},children:["ACCUMULATE: ",e.accumulateCount]}),r.jsxs("span",{style:{color:t.danger},children:["REDUCE: ",e.reduceCount]}),r.jsxs("span",{style:{color:t.warn},children:["HOLD: ",e.holdCount]}),r.jsxs("span",{style:{color:t.purple},children:["REBALANCE: ",e.rebalanceCount]})]})]}),r.jsxs(L,{p:18,children:[r.jsx(E,{style:{marginBottom:12},children:"Agent Insights"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.totalDecisions===0&&r.jsx("div",{style:{fontSize:12,color:t.dim,...h,textAlign:"center",padding:"16px 0"},children:"Run cycles to generate performance insights"}),e.sharpeRatio<2&&e.totalDecisions>0&&r.jsxs("div",{style:{background:`${t.warn}10`,border:`1px solid ${t.warn}30`,borderRadius:6,padding:"10px 14px",display:"flex",gap:8,alignItems:"flex-start"},children:[r.jsx("span",{style:{fontSize:11,color:t.warn,flexShrink:0},children:"⚠"}),r.jsx("span",{style:{fontSize:12,color:t.warn},children:"Sharpe Ratio below target — reduce position sizes during high-volatility periods"})]}),e.winRate<55&&e.totalDecisions>0&&r.jsxs("div",{style:{background:`${t.warn}10`,border:`1px solid ${t.warn}30`,borderRadius:6,padding:"10px 14px",display:"flex",gap:8,alignItems:"flex-start"},children:[r.jsx("span",{style:{fontSize:11,color:t.warn,flexShrink:0},children:"⚠"}),r.jsx("span",{style:{fontSize:12,color:t.warn},children:"Win rate below 55% — consider longer holding periods or wait for stronger momentum signals"})]}),e.maxDrawdown>15&&e.totalDecisions>0&&r.jsxs("div",{style:{background:`${t.danger}10`,border:`1px solid ${t.danger}30`,borderRadius:6,padding:"10px 14px",display:"flex",gap:8,alignItems:"flex-start"},children:[r.jsx("span",{style:{fontSize:11,color:t.danger,flexShrink:0},children:"✕"}),r.jsx("span",{style:{fontSize:12,color:t.danger},children:"High drawdown detected — tighten stop losses or reduce Kelly fraction"})]}),e.profitFactor<1.5&&e.totalDecisions>0&&r.jsxs("div",{style:{background:`${t.warn}10`,border:`1px solid ${t.warn}30`,borderRadius:6,padding:"10px 14px",display:"flex",gap:8,alignItems:"flex-start"},children:[r.jsx("span",{style:{fontSize:11,color:t.warn,flexShrink:0},children:"⚠"}),r.jsx("span",{style:{fontSize:12,color:t.warn},children:"Profit factor below 1.5 — review risk/reward ratios on losing entries"})]}),e.totalDecisions<30&&e.totalDecisions>0&&r.jsxs("div",{style:{background:`${t.dim}10`,border:`1px solid ${t.border}`,borderRadius:6,padding:"10px 14px",display:"flex",gap:8,alignItems:"flex-start"},children:[r.jsx("span",{style:{fontSize:11,color:t.dim,flexShrink:0},children:"ℹ"}),r.jsx("span",{style:{fontSize:12,color:t.dim},children:"Collecting data — need 30+ decisions for reliable statistical metrics"})]}),e.sharpeRatio>=2&&e.winRate>=55&&e.maxDrawdown<15&&e.totalDecisions>0&&r.jsxs("div",{style:{background:`${t.ok}10`,border:`1px solid ${t.ok}30`,borderRadius:6,padding:"10px 14px",display:"flex",gap:8,alignItems:"flex-start"},children:[r.jsx("span",{style:{fontSize:11,color:t.ok,flexShrink:0},children:"✓"}),r.jsx("span",{style:{fontSize:12,color:t.ok},children:"Excellent performance across all metrics — consider slightly increasing position sizing"})]})]})]})]})}export{fe as QuantAnalyticsPanel};
